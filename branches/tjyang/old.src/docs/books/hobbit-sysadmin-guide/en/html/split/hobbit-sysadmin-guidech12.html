<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>12 Managing change with Mercurial Queues</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- html4-uni,2,html,xhtml --> 
<meta name="src" content="hobbit-sysadmin-guide.tex" /> 
<meta name="date" content="2008-04-26 19:37:00" /> 
<link rel="stylesheet" type="text/css" href="hobbit-sysadmin-guide.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="hobbit-sysadmin-guidech13.html" >next</a>] [<a 
href="hobbit-sysadmin-guidech11.html" >prev</a>] [<a 
href="hobbit-sysadmin-guidech11.html#tailhobbit-sysadmin-guidech11.html" >prev-tail</a>] [<a 
href="#tailhobbit-sysadmin-guidech12.html">tail</a>] [<a 
href="hobbit-sysadmin-guide.html#hobbit-sysadmin-guidech12.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;12</span><br /><a 
 id="x16-26700012"></a>Managing change with Mercurial Queues</h2>
   <h3 class="sectionHead"><span class="titlemark">12.1    </span> <a 
 id="x16-26800012.1"></a>The patch management problem</h3>
<!--l. 7--><p class="noindent">Here is a common scenario: you need to install a software package from source, but you find a bug that you must fix in the
source before you can start using the package. You make your changes, forget about the package for a while, and a few months
later you need to upgrade to a newer version of the package. If the newer version of the package still has the bug, you must
extract your fix from the older source tree and apply it against the newer version. This is a tedious task, and it&#x2019;s easy to make
mistakes.
</p><!--l. 16--><p class="indent">   This is a simple case of the &#x201C;patch management&#x201D; problem. You have an &#x201C;upstream&#x201D; source tree that you can&#x2019;t change; you
need to make some local changes on top of the upstream tree; and you&#x2019;d like to be able to keep those changes separate, so that
you can apply them to newer versions of the upstream source.
</p><!--l. 22--><p class="indent">   The patch management problem arises in many situations. Probably the most visible is that a user of an open
source software project will contribute a bug fix or new feature to the project&#x2019;s maintainers in the form of a
patch.
</p><!--l. 27--><p class="indent">   Distributors of operating systems that include open source software often need to make changes to the packages they
distribute so that they will build properly in their environments.
</p><!--l. 31--><p class="indent">   When you have few changes to maintain, it is easy to manage a single patch using the standard <a 
 id="dx16-268001"></a><span 
class="pcrr7tn-">diff </span>and <a 
 id="dx16-268002"></a><span 
class="pcrr7tn-">patch </span>programs
(see section&#x00A0;<a 
href="#x16-27300012.4">12.4<!--tex4ht:ref: sec:mq:patch --></a> for a discussion of these tools). Once the number of changes grows, it starts to make sense to maintain
patches as discrete &#x201C;chunks of work,&#x201D; so that for example a single patch will contain only one bug fix (the patch might modify
several files, but it&#x2019;s doing &#x201C;only one thing&#x201D;), and you may have a number of such patches for different bugs you need fixed and
local changes you require. In this situation, if you submit a bug fix patch to the upstream maintainers of a package and they
include your fix in a subsequent release, you can simply drop that single patch when you&#x2019;re updating to the newer
release.
</p><!--l. 44--><p class="indent">   Maintaining a single patch against an upstream tree is a little tedious and error-prone, but not difficult. However, the
complexity of the problem grows rapidly as the number of patches you have to maintain increases. With more than a tiny
number of patches in hand, understanding which ones you have applied and maintaining them moves from messy to
overwhelming.
</p><!--l. 51--><p class="indent">   Fortunately, Mercurial includes a powerful extension, Mercurial Queues (or simply &#x201C;MQ&#x201D;), that massively simplifies the
patch management problem.
</p><!--l. 55--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.2    </span> <a 
 id="x16-26900012.2"></a>The prehistory of Mercurial Queues</h3>
<!--l. 58--><p class="noindent">During the late 1990s, several Linux kernel developers started to maintain &#x201C;patch series&#x201D; that modified the behaviour of the
Linux kernel. Some of these series were focused on stability, some on feature coverage, and others were more
speculative.
</p><!--l. 63--><p class="indent">   The sizes of these patch series grew rapidly. In 2002, Andrew Morton published some shell scripts he had been using to
automate the task of managing his patch queues. Andrew was successfully using these scripts to manage hundreds (sometimes
thousands) of patches on top of the Linux kernel.
</p><!--l. 69--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.2.1    </span> <a 
 id="x16-27000012.2.1"></a>A patchwork quilt</h4>
<!--l. 72--><p class="noindent">In early 2003, Andreas Gruenbacher and Martin Quinson borrowed the approach of Andrew&#x2019;s scripts and published a tool
called &#x201C;patchwork quilt&#x201D;&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span>, or simply &#x201C;quilt&#x201D; (see&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span> for a paper describing it). Because quilt substantially automated patch
management, it rapidly gained a large following among open source software developers.
                                                                                         
                                                                                         
</p><!--l. 79--><p class="indent">   Quilt manages a <span 
class="ptmri7t-">stack of patches </span>on top of a directory tree. To begin, you tell quilt to manage a directory tree, and tell it
which files you want to manage; it stores away the names and contents of those files. To fix a bug, you create a new patch (using
a single command), edit the files you need to fix, then &#x201C;refresh&#x201D; the patch.
</p><!--l. 85--><p class="indent">   The refresh step causes quilt to scan the directory tree; it updates the patch with all of the changes you have made. You can
create another patch on top of the first, which will track the changes required to modify the tree from &#x201C;tree with one patch
applied&#x201D; to &#x201C;tree with two patches applied&#x201D;.
</p><!--l. 91--><p class="indent">   You can <span 
class="ptmri7t-">change </span>which patches are applied to the tree. If you &#x201C;pop&#x201D; a patch, the changes made by that patch will
vanish from the directory tree. Quilt remembers which patches you have popped, though, so you can &#x201C;push&#x201D;
a popped patch again, and the directory tree will be restored to contain the modifications in the patch. Most
importantly, you can run the &#x201C;refresh&#x201D; command at any time, and the topmost applied patch will be updated. This
means that you can, at any time, change both which patches are applied and what modifications those patches
make.
</p><!--l. 101--><p class="indent">   Quilt knows nothing about revision control tools, so it works equally well on top of an unpacked tarball or a Subversion
working copy.
</p><!--l. 104--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.2.2    </span> <a 
 id="x16-27100012.2.2"></a>From patchwork quilt to Mercurial Queues</h4>
<!--l. 107--><p class="noindent">In mid-2005, Chris Mason took the features of quilt and wrote an extension that he called Mercurial Queues, which added
quilt-like behaviour to Mercurial.
</p><!--l. 111--><p class="indent">   The key difference between quilt and MQ is that quilt knows nothing about revision control systems, while MQ is
<span 
class="ptmri7t-">integrated </span>into Mercurial. Each patch that you push is represented as a Mercurial changeset. Pop a patch, and the changeset
goes away.
</p><!--l. 116--><p class="indent">   Because quilt does not care about revision control tools, it is still a tremendously useful piece of software to know about for
situations where you cannot use Mercurial and MQ.
</p><!--l. 120--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.3    </span> <a 
 id="x16-27200012.3"></a>The huge advantage of MQ</h3>
<!--l. 122--><p class="noindent">I cannot overstate the value that MQ offers through the unification of patches and revision control.
</p><!--l. 125--><p class="indent">   A major reason that patches have persisted in the free software and open source world&#x2014;in spite of the availability of
increasingly capable revision control tools over the years&#x2014;is the <span 
class="ptmri7t-">agility </span>they offer.
</p><!--l. 130--><p class="indent">   Traditional revision control tools make a permanent, irreversible record of everything that you do. While this has great
value, it&#x2019;s also somewhat stifling. If you want to perform a wild-eyed experiment, you have to be careful in how you go about it,
or you risk leaving unneeded&#x2014;or worse, misleading or destabilising&#x2014;traces of your missteps and errors in the permanent
revision record.
</p><!--l. 137--><p class="indent">   By contrast, MQ&#x2019;s marriage of distributed revision control with patches makes it much easier to isolate your work. Your
patches live on top of normal revision history, and you can make them disappear or reappear at will. If you don&#x2019;t like a patch,
you can drop it. If a patch isn&#x2019;t quite as you want it to be, simply fix it&#x2014;as many times as you need to, until you have refined it
into the form you desire.
</p><!--l. 144--><p class="indent">   As an example, the integration of patches with revision control makes understanding patches and debugging their
effects&#x2014;and their interplay with the code they&#x2019;re based on&#x2014;<span 
class="ptmri7t-">enormously </span>easier. Since every applied patch has an associated
changeset, you can use <a 
 id="dx16-272001"></a>&#x201C;<span 
class="pcrr7tn-">hg log </span><span 
class="pcrro7t-">filename</span>&#x201D; to see which changesets and patches affected a file. You can use the <a 
 id="dx16-272002"></a><span 
class="pcrr7tn-">bisect</span>
command to binary-search through all changesets and applied patches to see where a bug got introduced or fixed. You can use
the <a 
 id="dx16-272003"></a>&#x201C;<span 
class="pcrr7tn-">hg annotate</span>&#x201D; command to see which changeset or patch modified a particular line of a source file. And so
on.
                                                                                         
                                                                                         
</p><!--l. 155--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.4    </span> <a 
 id="x16-27300012.4"></a>Understanding patches</h3>
<!--l. 158--><p class="noindent">Because MQ doesn&#x2019;t hide its patch-oriented nature, it is helpful to understand what patches are, and a little about the tools that
work with them.
</p><!--l. 162--><p class="indent">   The traditional Unix <a 
 id="dx16-273001"></a><span 
class="pcrr7tn-">diff </span>command compares two files, and prints a list of differences between them. The <a 
 id="dx16-273002"></a><span 
class="pcrr7tn-">patch </span>command
understands these differences as <span 
class="ptmri7t-">modifications </span>to make to a file. Take a look at figure&#x00A0;<a 
href="#x16-2730291">12.1<!--tex4ht:ref: ex:mq:diff --></a> for a simple example of these
commands in action.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2730291"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-273004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'this</span><span 
class="pcrb7t-">&#x00A0;is</span><span 
class="pcrb7t-">&#x00A0;my</span><span 
class="pcrb7t-">&#x00A0;original</span><span 
class="pcrb7t-">&#x00A0;thought'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;oldfile</span>
<br class="fancyvrb" /><a 
 id="x16-273006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;have</span><span 
class="pcrb7t-">&#x00A0;changed</span><span 
class="pcrb7t-">&#x00A0;my</span><span 
class="pcrb7t-">&#x00A0;mind'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;newfile</span>
<br class="fancyvrb" /><a 
 id="x16-273008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">diff</span><span 
class="pcrb7t-">&#x00A0;-u</span><span 
class="pcrb7t-">&#x00A0;oldfile</span><span 
class="pcrb7t-">&#x00A0;newfile</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;tiny.patch</span>
<br class="fancyvrb" /><a 
 id="x16-273010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;tiny.patch</span>
<br class="fancyvrb" /><a 
 id="x16-273012r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;oldfile        2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04:20.000000000</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-273014r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;newfile        2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04:20.000000000</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-273016r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-1</span><span 
class="pcrr7tn-">&#x00A0;+1</span><span 
class="pcrr7tn-">&#x00A0;@@</span>
<br class="fancyvrb" /><a 
 id="x16-273018r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;-this</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;my</span><span 
class="pcrr7tn-">&#x00A0;original</span><span 
class="pcrr7tn-">&#x00A0;thought</span>
<br class="fancyvrb" /><a 
 id="x16-273020r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+i</span><span 
class="pcrr7tn-">&#x00A0;have</span><span 
class="pcrr7tn-">&#x00A0;changed</span><span 
class="pcrr7tn-">&#x00A0;my</span><span 
class="pcrr7tn-">&#x00A0;mind</span>
<br class="fancyvrb" /><a 
 id="x16-273022r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">patch</span><span 
class="pcrb7t-">&#x00A0;&#x003c;</span><span 
class="pcrb7t-">&#x00A0;tiny.patch</span>
<br class="fancyvrb" /><a 
 id="x16-273024r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patching</span><span 
class="pcrr7tn-">&#x00A0;file</span><span 
class="pcrr7tn-">&#x00A0;oldfile</span>
<br class="fancyvrb" /><a 
 id="x16-273026r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;oldfile</span>
<br class="fancyvrb" /><a 
 id="x16-273028r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;i</span><span 
class="pcrr7tn-">&#x00A0;have</span><span 
class="pcrr7tn-">&#x00A0;changed</span><span 
class="pcrr7tn-">&#x00A0;my</span><span 
class="pcrr7tn-">&#x00A0;mind</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.1: </td><td  
class="content">Simple uses of the <a 
 id="dx16-273030"></a><span 
class="pcrr7tn-">diff </span>and <a 
 id="dx16-273031"></a><span 
class="pcrr7tn-">patch </span>commands</td></tr></table><!--tex4ht:label?: x16-2730291 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 174--><p class="indent">   The type of file that <a 
 id="dx16-273032"></a><span 
class="pcrr7tn-">diff </span>generates (and <a 
 id="dx16-273033"></a><span 
class="pcrr7tn-">patch </span>takes as input) is called a &#x201C;patch&#x201D; or a &#x201C;diff&#x201D;; there is no difference between
a patch and a diff. (We&#x2019;ll use the term &#x201C;patch&#x201D;, since it&#x2019;s more commonly used.)
</p><!--l. 179--><p class="indent">   A patch file can start with arbitrary text; the <a 
 id="dx16-273034"></a><span 
class="pcrr7tn-">patch </span>command ignores this text, but MQ uses it as the commit message when
creating changesets. To find the beginning of the patch content, <a 
 id="dx16-273035"></a><span 
class="pcrr7tn-">patch </span>searches for the first line that starts with the string
&#x201C;<span 
class="pcrr7tn-">diff</span><span 
class="pcrr7tn-">&#x00A0;-</span>&#x201D;.
</p><!--l. 185--><p class="indent">   MQ works with <span 
class="ptmri7t-">unified </span>diffs (<a 
 id="dx16-273036"></a><span 
class="pcrr7tn-">patch </span>can accept several other diff formats, but MQ doesn&#x2019;t). A unified diff contains two
kinds of header. The <span 
class="ptmri7t-">file header </span>describes the file being modified; it contains the name of the file to modify. When <a 
 id="dx16-273037"></a><span 
class="pcrr7tn-">patch </span>sees a
new file header, it looks for a file with that name to start modifying.
</p><!--l. 192--><p class="indent">   After the file header comes a series of <span 
class="ptmri7t-">hunks</span>. Each hunk starts with a header; this identifies the range of line numbers within
the file that the hunk should modify. Following the header, a hunk starts and ends with a few (usually three) lines of text from
the unmodified file; these are called the <span 
class="ptmri7t-">context </span>for the hunk. If there&#x2019;s only a small amount of context between successive
hunks, <a 
 id="dx16-273038"></a><span 
class="pcrr7tn-">diff </span>doesn&#x2019;t print a new hunk header; it just runs the hunks together, with a few lines of context between
modifications.
</p><!--l. 201--><p class="indent">   Each line of context begins with a space character. Within the hunk, a line that begins with &#x201C;<span 
class="pcrr7tn-">-</span>&#x201D; means &#x201C;remove this line,&#x201D;
while a line that begins with &#x201C;<span 
class="pcrr7tn-">+</span>&#x201D; means &#x201C;insert this line.&#x201D; For example, a line that is modified is represented by one deletion and
one insertion.
</p><!--l. 207--><p class="indent">   We will return to some of the more subtle aspects of patches later (in section&#x00A0;<a 
href="#x16-28200012.6">12.6<!--tex4ht:ref: sec:mq:adv-patch --></a>), but you should have enough
information now to use MQ.
</p>
   <h3 class="sectionHead"><span class="titlemark">12.5    </span> <a 
 id="x16-27400012.5"></a>Getting started with Mercurial Queues</h3>
<!--l. 214--><p class="noindent">Because MQ is implemented as an extension, you must explicitly enable before you can use it. (You don&#x2019;t need to download
anything; MQ ships with the standard Mercurial distribution.) To enable MQ, edit your <span 
class="pcrr7tn-">~/.hgrc </span>file, and add the lines in
figure&#x00A0;<a 
href="#x16-27400012.5">12.5<!--tex4ht:ref: ex:mq:config --></a>.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2740052"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-274002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[extensions]</span>
<br class="fancyvrb" /><a 
 id="x16-274004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hgext.mq</span><span 
class="pcrr7tn-">&#x00A0;=</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.2: </td><td  
class="content">Contents to add to <span 
class="pcrr7tn-">~/.hgrc </span>to enable the MQ extension</td></tr></table><!--tex4ht:label?: x16-2740052 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 228--><p class="indent">   Once the extension is enabled, it will make a number of new commands available. To verify that the extension
is working, you can use <a 
 id="dx16-274006"></a>&#x201C;<span 
class="pcrr7tn-">hg help</span>&#x201D; to see if the <a 
 id="dx16-274007"></a><a 
 id="dx16-274008"></a>&#x201C;<span 
class="pcrr7tn-">hg qinit</span>&#x201D; command is now available; see the example in
figure&#x00A0;<a 
href="#x16-2740353">12.3<!--tex4ht:ref: ex:mq:enabled --></a>.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2740353"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-274010r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;help</span><span 
class="pcrb7t-">&#x00A0;qinit</span>
<br class="fancyvrb" /><a 
 id="x16-274012r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;qinit</span><span 
class="pcrr7tn-">&#x00A0;[-c]</span>
<br class="fancyvrb" /><a 
 id="x16-274014r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-274016r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;init</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;new</span><span 
class="pcrr7tn-">&#x00A0;queue</span><span 
class="pcrr7tn-">&#x00A0;repository</span>
<br class="fancyvrb" /><a 
 id="x16-274018r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-274020r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;The</span><span 
class="pcrr7tn-">&#x00A0;queue</span><span 
class="pcrr7tn-">&#x00A0;repository</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;unversioned</span><span 
class="pcrr7tn-">&#x00A0;by</span><span 
class="pcrr7tn-">&#x00A0;default.</span><span 
class="pcrr7tn-">&#x00A0;If</span><span 
class="pcrr7tn-">&#x00A0;-c</span><span 
class="pcrr7tn-">&#x00A0;is</span>
<br class="fancyvrb" /><a 
 id="x16-274022r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;specified,</span><span 
class="pcrr7tn-">&#x00A0;qinit</span><span 
class="pcrr7tn-">&#x00A0;will</span><span 
class="pcrr7tn-">&#x00A0;create</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;separate</span><span 
class="pcrr7tn-">&#x00A0;nested</span><span 
class="pcrr7tn-">&#x00A0;repository</span>
<br class="fancyvrb" /><a 
 id="x16-274024r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;for</span><span 
class="pcrr7tn-">&#x00A0;patches.</span><span 
class="pcrr7tn-">&#x00A0;Use</span><span 
class="pcrr7tn-">&#x00A0;qcommit</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;commit</span><span 
class="pcrr7tn-">&#x00A0;changes</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;queue</span>
<br class="fancyvrb" /><a 
 id="x16-274026r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;repository.</span>
<br class="fancyvrb" /><a 
 id="x16-274028r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-274030r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;options:</span>
<br class="fancyvrb" /><a 
 id="x16-274032r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-274034r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;-c</span><span 
class="pcrr7tn-">&#x00A0;--create-repo</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;create</span><span 
class="pcrr7tn-">&#x00A0;queue</span><span 
class="pcrr7tn-">&#x00A0;repository</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.3: </td><td  
class="content">How to verify that MQ is enabled</td></tr></table><!--tex4ht:label?: x16-2740353 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 239--><p class="indent">   You can use MQ with <span 
class="ptmri7t-">any </span>Mercurial repository, and its commands only operate within that repository. To get started,
simply prepare the repository using the <a 
 id="dx16-274036"></a><a 
 id="dx16-274037"></a>&#x201C;<span 
class="pcrr7tn-">hg qinit</span>&#x201D; command (see figure&#x00A0;<a 
href="#x16-2740554">12.4<!--tex4ht:ref: ex:mq:qinit --></a>). This command creates an empty directory
called <a 
 id="dx16-274038"></a><span 
class="pcrr7tn-">.hg/patches</span>, where MQ will keep its metadata. As with many Mercurial commands, the <a 
 id="dx16-274039"></a><a 
 id="dx16-274040"></a>&#x201C;<span 
class="pcrr7tn-">hg qinit</span>&#x201D; command prints
nothing if it succeeds.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2740554"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-274042r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;init</span><span 
class="pcrb7t-">&#x00A0;mq-sandbox</span>
<br class="fancyvrb" /><a 
 id="x16-274044r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;mq-sandbox</span>
<br class="fancyvrb" /><a 
 id="x16-274046r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'line</span><span 
class="pcrb7t-">&#x00A0;1'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-274048r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'another</span><span 
class="pcrb7t-">&#x00A0;line</span><span 
class="pcrb7t-">&#x00A0;1'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file2</span>
<br class="fancyvrb" /><a 
 id="x16-274050r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;add</span><span 
class="pcrb7t-">&#x00A0;file1</span><span 
class="pcrb7t-">&#x00A0;file2</span>
<br class="fancyvrb" /><a 
 id="x16-274052r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m'first</span><span 
class="pcrb7t-">&#x00A0;change'</span>
<br class="fancyvrb" /><a 
 id="x16-274054r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qinit</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.4: </td><td  
class="content">Preparing a repository for use with MQ</td></tr></table><!--tex4ht:label?: x16-2740554 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2740965"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-274057r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x16-274059r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0:88621f3050a8</span>
<br class="fancyvrb" /><a 
 id="x16-274061r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x16-274063r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x16-274065r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-274067r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x16-274069r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-274071r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qnew</span><span 
class="pcrb7t-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-274073r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x16-274075r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:2fd7dfef30eb</span>
<br class="fancyvrb" /><a 
 id="x16-274077r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;qtip</span>
<br class="fancyvrb" /><a 
 id="x16-274079r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-274081r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x16-274083r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;qbase</span>
<br class="fancyvrb" /><a 
 id="x16-274085r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x16-274087r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-274089r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;New</span><span 
class="pcrr7tn-">&#x00A0;patch:</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-274091r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-274093r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">ls</span><span 
class="pcrb7t-">&#x00A0;.hg/patches</span>
<br class="fancyvrb" /><a 
 id="x16-274095r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;series</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;status</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.5: </td><td  
class="content">Creating a new patch</td></tr></table><!--tex4ht:label?: x16-2740965 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">12.5.1    </span> <a 
 id="x16-27500012.5.1"></a>Creating a new patch</h4>
<!--l. 261--><p class="noindent">To begin work on a new patch, use the <a 
 id="dx16-275001"></a><a 
 id="dx16-275002"></a>&#x201C;<span 
class="pcrr7tn-">hg qnew</span>&#x201D; command. This command takes one argument, the name of the
patch to create. MQ will use this as the name of an actual file in the <a 
 id="dx16-275003"></a><span 
class="pcrr7tn-">.hg/patches </span>directory, as you can see in
figure&#x00A0;<a 
href="#x16-2740965">12.5<!--tex4ht:ref: ex:mq:qnew --></a>.
</p><!--l. 266--><p class="indent">   Also newly present in the <a 
 id="dx16-275004"></a><span 
class="pcrr7tn-">.hg/patches </span>directory are two other files, <a 
 id="dx16-275005"></a><span 
class="pcrr7tn-">series </span>and <a 
 id="dx16-275006"></a><span 
class="pcrr7tn-">status</span>. The <a 
 id="dx16-275007"></a><span 
class="pcrr7tn-">series </span>file lists all of the
patches that MQ knows about for this repository, with one patch per line. Mercurial uses the <a 
 id="dx16-275008"></a><span 
class="pcrr7tn-">status </span>file for internal
book-keeping; it tracks all of the patches that MQ has <span 
class="ptmri7t-">applied </span>in this repository.
</p>
   <div class="fbox"><span 
class="ptmb7t-">Note:   </span>You may sometimes want to edit the <span 
class="pcrr7tn-">series </span>file by hand; for example,
to change the sequence in which some patches are applied. However, manually
editing the <span 
class="pcrr7tn-">status </span>file is almost always a bad idea, as it&#x2019;s easy to corrupt MQ&#x2019;s
idea of what is happening.                                                                                         </div>
<!--l. 281--><p class="indent">   Once you have created your new patch, you can edit files in the working directory as you usually would. All of the normal
Mercurial commands, such as <a 
 id="dx16-275011"></a>&#x201C;<span 
class="pcrr7tn-">hg diff</span>&#x201D; and <a 
 id="dx16-275012"></a>&#x201C;<span 
class="pcrr7tn-">hg annotate</span>&#x201D;, work exactly as they did before.
</p><!--l. 286--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.5.2    </span> <a 
 id="x16-27600012.5.2"></a>Refreshing a patch</h4>
<!--l. 288--><p class="noindent">When you reach a point where you want to save your work, use the <a 
 id="dx16-276001"></a><a 
 id="dx16-276002"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; command (figure&#x00A0;<a 
href="#x16-2740965">12.5<!--tex4ht:ref: ex:mq:qnew --></a>) to update the patch
you are working on. This command folds the changes you have made in the working directory into your patch, and updates its
corresponding changeset to contain those changes.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2760456"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-276004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'line</span><span 
class="pcrb7t-">&#x00A0;2'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-276006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;diff</span>
<br class="fancyvrb" /><a 
 id="x16-276008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;2fd7dfef30eb</span><span 
class="pcrr7tn-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-276010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-276012r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-276014r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-1,1</span><span 
class="pcrr7tn-">&#x00A0;+1,2</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-276016r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-276018r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-276020r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qrefresh</span>
<br class="fancyvrb" /><a 
 id="x16-276022r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;diff</span>
<br class="fancyvrb" /><a 
 id="x16-276024r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span><span 
class="pcrb7t-">&#x00A0;--style=compact</span><span 
class="pcrb7t-">&#x00A0;--patch</span>
<br class="fancyvrb" /><a 
 id="x16-276026r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1[qtip,first.patch,tip,qbase]</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;396e00dd675d</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x16-276028r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-276030r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-276032r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;88621f3050a8</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;396e00dd675d</span><span 
class="pcrr7tn-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-276034r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-276036r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-276038r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-1,1</span><span 
class="pcrr7tn-">&#x00A0;+1,2</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-276040r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-276042r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-276044r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.6: </td><td  
class="content">Refreshing a patch</td></tr></table><!--tex4ht:label?: x16-2760456 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 300--><p class="indent">   You can run <a 
 id="dx16-276046"></a><a 
 id="dx16-276047"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; as often as you like, so it&#x2019;s a good way to &#x201C;checkpoint&#x201D; your work. Refresh your patch at an
opportune time; try an experiment; and if the experiment doesn&#x2019;t work out, <a 
 id="dx16-276048"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; your modifications back to the last
time you refreshed.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2760817"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-276050r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'line</span><span 
class="pcrb7t-">&#x00A0;3'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-276052r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x16-276054r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;M</span><span 
class="pcrr7tn-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-276056r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qrefresh</span>
<br class="fancyvrb" /><a 
 id="x16-276058r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span><span 
class="pcrb7t-">&#x00A0;--style=compact</span><span 
class="pcrb7t-">&#x00A0;--patch</span>
<br class="fancyvrb" /><a 
 id="x16-276060r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1[qtip,first.patch,tip,qbase]</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;50104d7b0f9b</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x16-276062r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-276064r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-276066r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;88621f3050a8</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;50104d7b0f9b</span><span 
class="pcrr7tn-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-276068r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:22</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-276070r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:23</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-276072r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-1,1</span><span 
class="pcrr7tn-">&#x00A0;+1,3</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-276074r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-276076r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-276078r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+line</span><span 
class="pcrr7tn-">&#x00A0;3</span>
<br class="fancyvrb" /><a 
 id="x16-276080r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.7: </td><td  
class="content">Refresh a patch many times to accumulate changes</td></tr></table><!--tex4ht:label?: x16-2760817 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">12.5.3    </span> <a 
 id="x16-27700012.5.3"></a>Stacking and tracking patches</h4>
<!--l. 313--><p class="noindent">Once you have finished working on a patch, or need to work on another, you can use the <a 
 id="dx16-277001"></a><a 
 id="dx16-277002"></a>&#x201C;<span 
class="pcrr7tn-">hg qnew</span>&#x201D; command again to create a
new patch. Mercurial will apply this patch on top of your existing patch. See figure&#x00A0;<a 
href="#x16-2770608">12.8<!--tex4ht:ref: ex:mq:qnew2 --></a> for an example. Notice that the patch
contains the changes in our prior patch as part of its context (you can see this more clearly in the output of <a 
 id="dx16-277003"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">annotate</span>&#x201D;).
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2770608"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-277005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qnew</span><span 
class="pcrb7t-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;log</span><span 
class="pcrb7t-">&#x00A0;--style=compact</span><span 
class="pcrb7t-">&#x00A0;--limit=2</span>
<br class="fancyvrb" /><a 
 id="x16-277009r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2[second.patch,qtip,tip]</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;c8de3a91dc96</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x16-277011r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;New</span><span 
class="pcrr7tn-">&#x00A0;patch:</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277013r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-277015r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1[first.patch,qbase]</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;50104d7b0f9b</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x16-277017r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277019r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-277021r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'line</span><span 
class="pcrb7t-">&#x00A0;4'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-277023r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qrefresh</span>
<br class="fancyvrb" /><a 
 id="x16-277025r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span><span 
class="pcrb7t-">&#x00A0;--style=compact</span><span 
class="pcrb7t-">&#x00A0;--patch</span>
<br class="fancyvrb" /><a 
 id="x16-277027r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2[second.patch,qtip,tip]</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;a3d13171a276</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2008-04-27</span><span 
class="pcrr7tn-">&#x00A0;00:04</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x16-277029r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277031r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-277033r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;50104d7b0f9b</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;a3d13171a276</span><span 
class="pcrr7tn-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-277035r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:23</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-277037r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/file1        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:23</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-277039r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-1,3</span><span 
class="pcrr7tn-">&#x00A0;+1,4</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-277041r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-277043r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-277045r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;3</span>
<br class="fancyvrb" /><a 
 id="x16-277047r22"></a><span 
class="ptmr7t-x-x-50">22</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+line</span><span 
class="pcrr7tn-">&#x00A0;4</span>
<br class="fancyvrb" /><a 
 id="x16-277049r23"></a><span 
class="ptmr7t-x-x-50">23</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-277051r24"></a><span 
class="ptmr7t-x-x-50">24</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;annotate</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-277053r25"></a><span 
class="ptmr7t-x-x-50">25</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0:</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-277055r26"></a><span 
class="ptmr7t-x-x-50">26</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-277057r27"></a><span 
class="ptmr7t-x-x-50">27</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;3</span>
<br class="fancyvrb" /><a 
 id="x16-277059r28"></a><span 
class="ptmr7t-x-x-50">28</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2:</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;4</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.8: </td><td  
class="content">Stacking a second patch on top of the first</td></tr></table><!--tex4ht:label?: x16-2770608 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 326--><p class="indent">   So far, with the exception of <a 
 id="dx16-277061"></a><a 
 id="dx16-277062"></a>&#x201C;<span 
class="pcrr7tn-">hg qnew</span>&#x201D; and <a 
 id="dx16-277063"></a><a 
 id="dx16-277064"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D;, we&#x2019;ve been careful to only use regular Mercurial commands.
However, MQ provides many commands that are easier to use when you are thinking about patches, as illustrated in
figure&#x00A0;<a 
href="#x16-2770819">12.9<!--tex4ht:ref: ex:mq:qseries --></a>:
</p>
     <ul><li><span class="dt">
     </span><span class="dd">The <a 
 id="dx16-277065"></a><a 
 id="dx16-277066"></a>&#x201C;<span 
class="pcrr7tn-">hg qseries</span>&#x201D; command lists every patch that MQ knows about in this repository, from oldest to newest
     (most recently <span 
class="ptmri7t-">created</span>).
     </span><li><span class="dt">
     </span><span class="dd">The <a 
 id="dx16-277067"></a><a 
 id="dx16-277068"></a>&#x201C;<span 
class="pcrr7tn-">hg qapplied</span>&#x201D; command lists every patch that MQ has <span 
class="ptmri7t-">applied </span>in this repository, again from oldest to
     newest (most recently applied).</li></ul>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-2770819"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-277070r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qseries</span>
<br class="fancyvrb" /><a 
 id="x16-277072r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277074r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277076r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qapplied</span>
<br class="fancyvrb" /><a 
 id="x16-277078r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-277080r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.9: </td><td  
class="content">Understanding the patch stack with <a 
 id="dx16-277082"></a><a 
 id="dx16-277083"></a>&#x201C;<span 
class="pcrr7tn-">hg qseries</span>&#x201D; and <a 
 id="dx16-277084"></a><a 
 id="dx16-277085"></a>&#x201C;<span 
class="pcrr7tn-">hg qapplied</span>&#x201D;</td></tr></table><!--tex4ht:label?: x16-2770819 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">12.5.4    </span> <a 
 id="x16-27800012.5.4"></a>Manipulating the patch stack</h4>
<!--l. 349--><p class="noindent">The previous discussion implied that there must be a difference between &#x201C;known&#x201D; and &#x201C;applied&#x201D; patches, and there is. MQ can
manage a patch without it being applied in the repository.
</p><!--l. 353--><p class="indent">   An <span 
class="ptmri7t-">applied </span>patch has a corresponding changeset in the repository, and the effects of the patch and changeset are visible in
the working directory. You can undo the application of a patch using the <a 
 id="dx16-278001"></a><a 
 id="dx16-278002"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D; command. MQ still <span 
class="ptmri7t-">knows about</span>, or
manages, a popped patch, but the patch no longer has a corresponding changeset in the repository, and the working directory
does not contain the changes made by the patch. Figure&#x00A0;<a 
href="#x16-27800310">12.10<!--tex4ht:ref: fig:mq:stack --></a> illustrates the difference between applied and tracked
patches.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-27800310"></a>
                                                                                         
                                                                                         
<!--l. 364--><p class="noindent"><img 
src="mq-stack.png" alt="PIC"  
 />
<br /> </p><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.10: </td><td  
class="content">Applied and unapplied patches in the MQ patch stack</td></tr></table><!--tex4ht:label?: x16-27800310 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 369--><p class="indent">   You can reapply an unapplied, or popped, patch using the <a 
 id="dx16-278004"></a><a 
 id="dx16-278005"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; command. This creates a new changeset to
correspond to the patch, and the patch&#x2019;s changes once again become present in the working directory. See figure&#x00A0;<a 
href="#x16-27804211">12.11<!--tex4ht:ref: ex:mq:qpop --></a> for
examples of <a 
 id="dx16-278006"></a><a 
 id="dx16-278007"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D; and <a 
 id="dx16-278008"></a><a 
 id="dx16-278009"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; in action. Notice that once we have popped a patch or two patches, the output of <a 
 id="dx16-278010"></a><a 
 id="dx16-278011"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">qseries</span>&#x201D; remains the same, while that of <a 
 id="dx16-278012"></a><a 
 id="dx16-278013"></a>&#x201C;<span 
class="pcrr7tn-">hg qapplied</span>&#x201D; has changed.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-27804211"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-278015r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qapplied</span>
<br class="fancyvrb" /><a 
 id="x16-278017r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-278019r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-278021r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qpop</span>
<br class="fancyvrb" /><a 
 id="x16-278023r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Now</span><span 
class="pcrr7tn-">&#x00A0;at:</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-278025r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qseries</span>
<br class="fancyvrb" /><a 
 id="x16-278027r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-278029r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-278031r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qapplied</span>
<br class="fancyvrb" /><a 
 id="x16-278033r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-278035r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-278037r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-278039r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-278041r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;3</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.11: </td><td  
class="content">Modifying the stack of applied patches</td></tr></table><!--tex4ht:label?: x16-27804211 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">12.5.5    </span> <a 
 id="x16-27900012.5.5"></a>Pushing and popping many patches</h4>
<!--l. 385--><p class="noindent">While <a 
 id="dx16-279001"></a><a 
 id="dx16-279002"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; and <a 
 id="dx16-279003"></a><a 
 id="dx16-279004"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D; each operate on a single patch at a time by default, you can push and pop many patches in
one go. The <a 
 id="dx16-279005"></a><a 
 id="dx16-279006"></a><span 
class="pcrr7tn-">-a </span>option to <a 
 id="dx16-279007"></a><a 
 id="dx16-279008"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; causes it to push all unapplied patches, while the <a 
 id="dx16-279009"></a><a 
 id="dx16-279010"></a><span 
class="pcrr7tn-">-a </span>option to <a 
 id="dx16-279011"></a><a 
 id="dx16-279012"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D;
causes it to pop all applied patches. (For some more ways to push and pop many patches, see section&#x00A0;<a 
href="#x16-28800012.7">12.7<!--tex4ht:ref: sec:mq:perf --></a>
below.)
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-27902912"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-279014r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qpush</span><span 
class="pcrb7t-">&#x00A0;-a</span>
<br class="fancyvrb" /><a 
 id="x16-279016r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;applying</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-279018r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Now</span><span 
class="pcrr7tn-">&#x00A0;at:</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-279020r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;file1</span>
<br class="fancyvrb" /><a 
 id="x16-279022r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x16-279024r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;2</span>
<br class="fancyvrb" /><a 
 id="x16-279026r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;3</span>
<br class="fancyvrb" /><a 
 id="x16-279028r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;line</span><span 
class="pcrr7tn-">&#x00A0;4</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.12: </td><td  
class="content">Pushing all unapplied patches</td></tr></table><!--tex4ht:label?: x16-27902912 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">12.5.6    </span> <a 
 id="x16-28000012.5.6"></a>Safety checks, and overriding them</h4>
<!--l. 400--><p class="noindent">Several MQ commands check the working directory before they do anything, and fail if they find any modifications. They do
this to ensure that you won&#x2019;t lose any changes that you have made, but not yet incorporated into a patch. Figure&#x00A0;<a 
href="#x16-28001213">12.13<!--tex4ht:ref: ex:mq:add --></a>
illustrates this; the <a 
 id="dx16-280001"></a><a 
 id="dx16-280002"></a>&#x201C;<span 
class="pcrr7tn-">hg qnew</span>&#x201D; command will not create a new patch if there are outstanding changes, caused in this case by the
<a 
 id="dx16-280003"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; of <span 
class="pcrr7tn-">file3</span>.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-28001213"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-280005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;'file</span><span 
class="pcrb7t-">&#x00A0;3,</span><span 
class="pcrb7t-">&#x00A0;line</span><span 
class="pcrb7t-">&#x00A0;1'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file3</span>
<br class="fancyvrb" /><a 
 id="x16-280007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qnew</span><span 
class="pcrb7t-">&#x00A0;add-file3.patch</span>
<br class="fancyvrb" /><a 
 id="x16-280009r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qnew</span><span 
class="pcrb7t-">&#x00A0;-f</span><span 
class="pcrb7t-">&#x00A0;add-file3.patch</span>
<br class="fancyvrb" /><a 
 id="x16-280011r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;"add-file3.patch"</span><span 
class="pcrr7tn-">&#x00A0;already</span><span 
class="pcrr7tn-">&#x00A0;exists</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.13: </td><td  
class="content">Forcibly creating a patch</td></tr></table><!--tex4ht:label?: x16-28001213 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 414--><p class="indent">   Commands that check the working directory all take an &#x201C;I know what I&#x2019;m doing&#x201D; option, which is always
named <span 
class="pcrr7tn-">-f</span>. The exact meaning of <span 
class="pcrr7tn-">-f </span>depends on the command. For example, <a 
 id="dx16-280013"></a>&#x201C;<span 
class="pcrr7tn-">hg qnew</span> <a 
 id="dx16-280014"></a><a 
 id="dx16-280015"></a><span 
class="pcrr7tn-">-f</span>&#x201D; will incorporate any
outstanding changes into the new patch it creates, but <a 
 id="dx16-280016"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span> <a 
 id="dx16-280017"></a><a 
 id="dx16-280018"></a><span 
class="pcrr7tn-">-f</span>&#x201D; will revert modifications to any files affected
by the patch that it is popping. Be sure to read the documentation for a command&#x2019;s <span 
class="pcrr7tn-">-f </span>option before you use
it!
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.5.7    </span> <a 
 id="x16-28100012.5.7"></a>Working on several patches at once</h4>
<!--l. 425--><p class="noindent">The <a 
 id="dx16-281001"></a><a 
 id="dx16-281002"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; command always refreshes the <span 
class="ptmri7t-">topmost </span>applied patch. This means that you can suspend work
on one patch (by refreshing it), pop or push to make a different patch the top, and work on <span 
class="ptmri7t-">that </span>patch for a
while.
</p><!--l. 430--><p class="indent">   Here&#x2019;s an example that illustrates how you can use this ability. Let&#x2019;s say you&#x2019;re developing a new feature as two patches.
The first is a change to the core of your software, and the second&#x2014;layered on top of the first&#x2014;changes the user interface to use
the code you just added to the core. If you notice a bug in the core while you&#x2019;re working on the UI patch, it&#x2019;s easy to fix the
core. Simply <a 
 id="dx16-281003"></a><a 
 id="dx16-281004"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; the UI patch to save your in-progress changes, and <a 
 id="dx16-281005"></a><a 
 id="dx16-281006"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D; down to the core patch. Fix the
core bug, <a 
 id="dx16-281007"></a><a 
 id="dx16-281008"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; the core patch, and <a 
 id="dx16-281009"></a><a 
 id="dx16-281010"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; back to the UI patch to continue where you left
off.
</p><!--l. 441--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.6    </span> <a 
 id="x16-28200012.6"></a>More about patches</h3>
<!--l. 444--><p class="noindent">MQ uses the GNU <a 
 id="dx16-282001"></a><span 
class="pcrr7tn-">patch </span>command to apply patches, so it&#x2019;s helpful to know a few more detailed aspects of how <a 
 id="dx16-282002"></a><span 
class="pcrr7tn-">patch </span>works,
and about patches themselves.
</p><!--l. 448--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.6.1    </span> <a 
 id="x16-28300012.6.1"></a>The strip count</h4>
<!--l. 450--><p class="noindent">If you look at the file headers in a patch, you will notice that the pathnames usually have an extra component on the front that
isn&#x2019;t present in the actual path name. This is a holdover from the way that people used to generate patches (people still do this,
but it&#x2019;s somewhat rare with modern revision control tools).
</p><!--l. 456--><p class="indent">   Alice would unpack a tarball, edit her files, then decide that she wanted to create a patch. So she&#x2019;d rename her working
directory, unpack the tarball again (hence the need for the rename), and use the <a 
 id="dx16-283001"></a><span 
class="pcrr7tn-">-r </span>and <a 
 id="dx16-283002"></a><span 
class="pcrr7tn-">-N </span>options to <a 
 id="dx16-283003"></a><span 
class="pcrr7tn-">diff </span>to recursively
generate a patch between the unmodified directory and the modified one. The result would be that the name of the unmodified
directory would be at the front of the left-hand path in every file header, and the name of the modified directory would be at the
front of the right-hand path.
</p><!--l. 466--><p class="indent">   Since someone receiving a patch from the Alices of the net would be unlikely to have unmodified and modified directories
with exactly the same names, the <a 
 id="dx16-283004"></a><span 
class="pcrr7tn-">patch </span>command has a <a 
 id="dx16-283005"></a><span 
class="pcrr7tn-">-p </span>option that indicates the number of leading path name components
to strip when trying to apply a patch. This number is called the <span 
class="ptmri7t-">strip count</span>.
</p><!--l. 473--><p class="indent">   An option of &#x201C;<span 
class="pcrr7tn-">-p1</span>&#x201D; means &#x201C;use a strip count of one&#x201D;. If <a 
 id="dx16-283006"></a><span 
class="pcrr7tn-">patch </span>sees a file name <span 
class="pcrr7tn-">foo/bar/baz </span>in a file header, it will strip
<span 
class="pcrr7tn-">foo </span>and try to patch a file named <span 
class="pcrr7tn-">bar/baz</span>. (Strictly speaking, the strip count refers to the number of <span 
class="ptmri7t-">path separators </span>(and the
components that go with them ) to strip. A strip count of one will turn <span 
class="pcrr7tn-">foo/bar </span>into <span 
class="pcrr7tn-">bar</span>, but <span 
class="pcrr7tn-">/foo/bar </span>(notice the extra
leading slash) into <span 
class="pcrr7tn-">foo/bar</span>.)
</p><!--l. 482--><p class="indent">   The &#x201C;standard&#x201D; strip count for patches is one; almost all patches contain one leading path name component that needs to be
stripped. Mercurial&#x2019;s <a 
 id="dx16-283007"></a>&#x201C;<span 
class="pcrr7tn-">hg diff</span>&#x201D; command generates path names in this form, and the <a 
 id="dx16-283008"></a>&#x201C;<span 
class="pcrr7tn-">hg import</span>&#x201D; command and MQ expect
patches to have a strip count of one.
                                                                                         
                                                                                         
</p><!--l. 488--><p class="indent">   If you receive a patch from someone that you want to add to your patch queue, and the patch needs a strip count other than
one, you cannot just <a 
 id="dx16-283009"></a><a 
 id="dx16-283010"></a>&#x201C;<span 
class="pcrr7tn-">hg qimport</span>&#x201D; the patch, because <a 
 id="dx16-283011"></a><a 
 id="dx16-283012"></a>&#x201C;<span 
class="pcrr7tn-">hg qimport</span>&#x201D; does not yet have a <span 
class="pcrr7tn-">-p </span>option (see&#x00A0;<a 
 id="dx16-283013"></a><a 
href="http://www.selenic.com/mercurial/bts/issue311" >Mercurial bug
no.&#x00A0;311</a>). Your best bet is to <a 
 id="dx16-283014"></a><a 
 id="dx16-283015"></a>&#x201C;<span 
class="pcrr7tn-">hg qnew</span>&#x201D; a patch of your own, then use <a 
 id="dx16-283016"></a>&#x201C;<span 
class="pcrr7tn-">patch -p</span><span 
class="pcrro7t-">N</span>&#x201D; to apply their patch, followed by <a 
 id="dx16-283017"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">addremove</span>&#x201D; to pick up any files added or removed by the patch, followed by <a 
 id="dx16-283018"></a><a 
 id="dx16-283019"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D;. This complexity may become
unnecessary; see&#x00A0;<a 
 id="dx16-283020"></a><a 
href="http://www.selenic.com/mercurial/bts/issue311" >Mercurial bug no.&#x00A0;311</a> for details.
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.6.2    </span> <a 
 id="x16-28400012.6.2"></a>Strategies for applying a patch</h4>
<!--l. 498--><p class="noindent">When <a 
 id="dx16-284001"></a><span 
class="pcrr7tn-">patch </span>applies a hunk, it tries a handful of successively less accurate strategies to try to make the hunk apply. This
falling-back technique often makes it possible to take a patch that was generated against an old version of a file, and apply it
against a newer version of that file.
</p><!--l. 504--><p class="indent">   First, <a 
 id="dx16-284002"></a><span 
class="pcrr7tn-">patch </span>tries an exact match, where the line numbers, the context, and the text to be modified must apply exactly. If it
cannot make an exact match, it tries to find an exact match for the context, without honouring the line numbering information.
If this succeeds, it prints a line of output saying that the hunk was applied, but at some <span 
class="ptmri7t-">offset </span>from the original line
number.
</p><!--l. 511--><p class="indent">   If a context-only match fails, <a 
 id="dx16-284003"></a><span 
class="pcrr7tn-">patch </span>removes the first and last lines of the context, and tries a <span 
class="ptmri7t-">reduced </span>context-only
match. If the hunk with reduced context succeeds, it prints a message saying that it applied the hunk with a <span 
class="ptmri7t-">fuzz</span>
<span 
class="ptmri7t-">factor </span>(the number after the fuzz factor indicates how many lines of context <a 
 id="dx16-284004"></a><span 
class="pcrr7tn-">patch </span>had to trim before the patch
applied).
</p><!--l. 518--><p class="indent">   When neither of these techniques works, <a 
 id="dx16-284005"></a><span 
class="pcrr7tn-">patch </span>prints a message saying that the hunk in question was rejected. It saves
rejected hunks (also simply called &#x201C;rejects&#x201D;) to a file with the same name, and an added <a 
 id="dx16-284006"></a><span 
class="pcrr7tn-">.rej </span>extension. It also saves an
unmodified copy of the file with a <a 
 id="dx16-284007"></a><span 
class="pcrr7tn-">.orig </span>extension; the copy of the file without any extensions will contain any changes made
by hunks that <span 
class="ptmri7t-">did </span>apply cleanly. If you have a patch that modifies <span 
class="pcrr7tn-">foo </span>with six hunks, and one of them fails to apply, you will
have: an unmodified <span 
class="pcrr7tn-">foo.orig</span>, a <span 
class="pcrr7tn-">foo.rej </span>containing one hunk, and <span 
class="pcrr7tn-">foo</span>, containing the changes made by the five successful
five hunks.
</p><!--l. 530--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.6.3    </span> <a 
 id="x16-28500012.6.3"></a>Some quirks of patch representation</h4>
<!--l. 532--><p class="noindent">There are a few useful things to know about how <a 
 id="dx16-285001"></a><span 
class="pcrr7tn-">patch </span>works with files. </p>
     <ul><li><span class="dt">
     </span><span class="dd">This should already be obvious, but <a 
 id="dx16-285002"></a><span 
class="pcrr7tn-">patch </span>cannot handle binary files.
     </span><li><span class="dt">
     </span><span class="dd">Neither does it care about the executable bit; it creates new files as readable, but not executable.
     </span><li><span class="dt">
     </span><span class="dd"><a 
 id="dx16-285003"></a><span 
class="pcrr7tn-">patch </span>treats the removal of a file as a diff between the file to be removed and the empty file. So your idea of &#x201C;I
     deleted this file&#x201D; looks like &#x201C;every line of this file was deleted&#x201D; in a patch.
     </span><li><span class="dt">
     </span><span class="dd">It treats the addition of a file as a diff between the empty file and the file to be added. So in a patch, your idea of
     &#x201C;I added this file&#x201D; looks like &#x201C;every line of this file was added&#x201D;.
     </span><li><span class="dt">
     </span><span class="dd">It treats a renamed file as the removal of the old name, and the addition of the new name. This means that
     renamed files have a big footprint in patches. (Note also that Mercurial does not currently try to infer when files
     have been renamed or copied in a patch.)
                                                                                         
                                                                                         
     </span><li><span class="dt">
     </span><span class="dd"><a 
 id="dx16-285004"></a><span 
class="pcrr7tn-">patch </span>cannot represent empty files, so you cannot use a patch to represent the notion &#x201C;I added this empty file to
     the tree&#x201D;.</li></ul>
<!--l. 554--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.6.4    </span> <a 
 id="x16-28600012.6.4"></a>Beware the fuzz</h4>
<!--l. 556--><p class="noindent">While applying a hunk at an offset, or with a fuzz factor, will often be completely successful, these inexact techniques naturally
leave open the possibility of corrupting the patched file. The most common cases typically involve applying a patch twice, or at
an incorrect location in the file. If <a 
 id="dx16-286001"></a><span 
class="pcrr7tn-">patch </span>or <a 
 id="dx16-286002"></a><a 
 id="dx16-286003"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; ever mentions an offset or fuzz factor, you should make sure that the
modified files are correct afterwards.
</p><!--l. 564--><p class="indent">   It&#x2019;s often a good idea to refresh a patch that has applied with an offset or fuzz factor; refreshing the patch generates new
context information that will make it apply cleanly. I say &#x201C;often,&#x201D; not &#x201C;always,&#x201D; because sometimes refreshing a patch will make
it fail to apply against a different revision of the underlying files. In some cases, such as when you&#x2019;re maintaining a patch that
must sit on top of multiple versions of a source tree, it&#x2019;s acceptable to have a patch apply with some fuzz, provided you&#x2019;ve
verified the results of the patching process in such cases.
</p><!--l. 574--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.6.5    </span> <a 
 id="x16-28700012.6.5"></a>Handling rejection</h4>
<!--l. 576--><p class="noindent">If <a 
 id="dx16-287001"></a><a 
 id="dx16-287002"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; fails to apply a patch, it will print an error message and exit. If it has left <a 
 id="dx16-287003"></a><span 
class="pcrr7tn-">.rej </span>files behind, it is usually best to
fix up the rejected hunks before you push more patches or do any further work.
</p><!--l. 581--><p class="indent">   If your patch <span 
class="ptmri7t-">used to </span>apply cleanly, and no longer does because you&#x2019;ve changed the underlying code that your patches are
based on, Mercurial Queues can help; see section&#x00A0;<a 
href="#x16-28900012.8">12.8<!--tex4ht:ref: sec:mq:merge --></a> for details.
</p><!--l. 585--><p class="indent">   Unfortunately, there aren&#x2019;t any great techniques for dealing with rejected hunks. Most often, you&#x2019;ll need to view the <a 
 id="dx16-287004"></a><span 
class="pcrr7tn-">.rej</span>
file and edit the target file, applying the rejected hunks by hand.
</p><!--l. 589--><p class="indent">   If you&#x2019;re feeling adventurous, Neil Brown, a Linux kernel hacker, wrote a tool called <a 
 id="dx16-287005"></a><span 
class="pcrr7tn-">wiggle</span>&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span>, which is more vigorous
than <a 
 id="dx16-287006"></a><span 
class="pcrr7tn-">patch </span>in its attempts to make a patch apply.
</p><!--l. 593--><p class="indent">   Another Linux kernel hacker, Chris Mason (the author of Mercurial Queues), wrote a similar tool called <a 
 id="dx16-287007"></a><span 
class="pcrr7tn-">mpatch</span>&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span>, which
takes a simple approach to automating the application of hunks rejected by <a 
 id="dx16-287008"></a><span 
class="pcrr7tn-">patch</span>. The <a 
 id="dx16-287009"></a><span 
class="pcrr7tn-">mpatch </span>command can help with four
common reasons that a hunk may be rejected:
</p>
     <ul><li><span class="dt">
     </span><span class="dd">The context in the middle of a hunk has changed.
     </span><li><span class="dt">
     </span><span class="dd">A hunk is missing some context at the beginning or end.
     </span><li><span class="dt">
     </span><span class="dd">A large hunk might apply better&#x2014;either entirely or in part&#x2014;if it was broken up into smaller hunks.
     </span><li><span class="dt">
     </span><span class="dd">A hunk removes lines with slightly different content than those currently present in the file.</li></ul>
<!--l. 609--><p class="indent">   If you use <a 
 id="dx16-287010"></a><span 
class="pcrr7tn-">wiggle </span>or <a 
 id="dx16-287011"></a><span 
class="pcrr7tn-">mpatch</span>, you should be doubly careful to check your results when you&#x2019;re done. In fact, <a 
 id="dx16-287012"></a><span 
class="pcrr7tn-">mpatch</span>
enforces this method of double-checking the tool&#x2019;s output, by automatically dropping you into a merge program when it has
done its job, so that you can verify its work and finish off any remaining merges.
                                                                                         
                                                                                         
</p><!--l. 616--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.7    </span> <a 
 id="x16-28800012.7"></a>Getting the best performance out of MQ</h3>
<!--l. 619--><p class="noindent">MQ is very efficient at handling a large number of patches. I ran some performance experiments in mid-2006 for a talk that I
gave at the 2006 EuroPython conference&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span>. I used as my data set the Linux 2.6.17-mm1 patch series, which consists of 1,738
patches. I applied these on top of a Linux kernel repository containing all 27,472 revisions between Linux 2.6.12-rc2 and Linux
2.6.17.
</p><!--l. 627--><p class="indent">   On my old, slow laptop, I was able to <a 
 id="dx16-288001"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span> <a 
 id="dx16-288002"></a><a 
 id="dx16-288003"></a><span 
class="pcrr7tn-">-a</span>&#x201D; all 1,738 patches in 3.5 minutes, and <a 
 id="dx16-288004"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span> <a 
 id="dx16-288005"></a><a 
 id="dx16-288006"></a><span 
class="pcrr7tn-">-a</span>&#x201D; them all in 30
seconds. (On a newer laptop, the time to push all patches dropped to two minutes.) I could <a 
 id="dx16-288007"></a><a 
 id="dx16-288008"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; one of the biggest
patches (which made 22,779 lines of changes to 287 files) in 6.6 seconds.
</p><!--l. 634--><p class="indent">   Clearly, MQ is well suited to working in large trees, but there are a few tricks you can use to get the best performance of
it.
</p><!--l. 637--><p class="indent">   First of all, try to &#x201C;batch&#x201D; operations together. Every time you run <a 
 id="dx16-288009"></a><a 
 id="dx16-288010"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; or <a 
 id="dx16-288011"></a><a 
 id="dx16-288012"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D;, these commands scan the
working directory once to make sure you haven&#x2019;t made some changes and then forgotten to run <a 
 id="dx16-288013"></a><a 
 id="dx16-288014"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D;. On a small
tree, the time that this scan takes is unnoticeable. However, on a medium-sized tree (containing tens of thousands of files), it
can take a second or more.
</p><!--l. 644--><p class="indent">   The <a 
 id="dx16-288015"></a><a 
 id="dx16-288016"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; and <a 
 id="dx16-288017"></a><a 
 id="dx16-288018"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D; commands allow you to push and pop multiple patches at a time. You can identify the
&#x201C;destination patch&#x201D; that you want to end up at. When you <a 
 id="dx16-288019"></a><a 
 id="dx16-288020"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; with a destination specified, it will push patches until
that patch is at the top of the applied stack. When you <a 
 id="dx16-288021"></a><a 
 id="dx16-288022"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D; to a destination, MQ will pop patches until the destination
patch is at the top.
</p><!--l. 651--><p class="indent">   You can identify a destination patch using either the name of the patch, or by number. If you use numeric addressing,
patches are counted from zero; this means that the first patch is zero, the second is one, and so on.
</p><!--l. 656--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.8    </span> <a 
 id="x16-28900012.8"></a>Updating your patches when the underlying code changes</h3>
<!--l. 659--><p class="noindent">It&#x2019;s common to have a stack of patches on top of an underlying repository that you don&#x2019;t modify directly. If you&#x2019;re working on
changes to third-party code, or on a feature that is taking longer to develop than the rate of change of the code beneath, you will
often need to sync up with the underlying code, and fix up any hunks in your patches that no longer apply. This is called
<span 
class="ptmri7t-">rebasing </span>your patch series.
</p><!--l. 667--><p class="indent">   The simplest way to do this is to <a 
 id="dx16-289001"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span> <a 
 id="dx16-289002"></a><a 
 id="dx16-289003"></a><span 
class="pcrr7tn-">-a</span>&#x201D; your patches, then <a 
 id="dx16-289004"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D; changes into the underlying repository, and
finally <a 
 id="dx16-289005"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span> <a 
 id="dx16-289006"></a><a 
 id="dx16-289007"></a><span 
class="pcrr7tn-">-a</span>&#x201D; your patches again. MQ will stop pushing any time it runs across a patch that fails to apply during
conflicts, allowing you to fix your conflicts, <a 
 id="dx16-289008"></a><a 
 id="dx16-289009"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; the affected patch, and continue pushing until you have fixed your
entire stack.
</p><!--l. 675--><p class="indent">   This approach is easy to use and works well if you don&#x2019;t expect changes to the underlying code to affect how well your
patches apply. If your patch stack touches code that is modified frequently or invasively in the underlying repository, however,
fixing up rejected hunks by hand quickly becomes tiresome.
</p><!--l. 681--><p class="indent">   It&#x2019;s possible to partially automate the rebasing process. If your patches apply cleanly against some revision of the
underlying repo, MQ can use this information to help you to resolve conflicts between your patches and a different
revision.
</p><!--l. 686--><p class="indent">   The process is a little involved.
     </p><ol  class="enumerate1" >
     <li class="enumerate"><a 
 id="x16-289011x1"></a>To begin, <a 
 id="dx16-289012"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush -a</span>&#x201D; all of your patches on top of the revision where you know that they apply cleanly.
     </li>
     <li class="enumerate"><a 
 id="x16-289014x2"></a>Save a backup copy of your patch directory using <a 
 id="dx16-289015"></a>&#x201C;<span 
class="pcrr7tn-">hg qsave</span> <a 
 id="dx16-289016"></a><a 
 id="dx16-289017"></a><span 
class="pcrr7tn-">-e</span> <a 
 id="dx16-289018"></a><a 
 id="dx16-289019"></a><span 
class="pcrr7tn-">-c</span>&#x201D;. This prints the name of the directory that
     it has saved the patches in. It will save the patches to a directory called <a 
 id="dx16-289020"></a><span 
class="pcrr7tn-">.hg/patches.</span><span 
class="pcrro7t-">N</span>, where <span 
class="pcrro7t-">N </span>is a small
     integer. It also commits a &#x201C;save changeset&#x201D; on top of your applied patches; this is for internal book-keeping, and
     records the states of the <a 
 id="dx16-289021"></a><span 
class="pcrr7tn-">series </span>and <a 
 id="dx16-289022"></a><span 
class="pcrr7tn-">status </span>files.
                                                                                         
                                                                                         
     </li>
     <li class="enumerate"><a 
 id="x16-289024x3"></a>Use <a 
 id="dx16-289025"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D; to bring new changes into the underlying repository. (Don&#x2019;t run <a 
 id="dx16-289026"></a>&#x201C;<span 
class="pcrr7tn-">hg pull -u</span>&#x201D;; see below for
     why.)
     </li>
     <li class="enumerate"><a 
 id="x16-289028x4"></a>Update to the new tip revision, using <a 
 id="dx16-289029"></a>&#x201C;<span 
class="pcrr7tn-">hg update</span> <a 
 id="dx16-289030"></a><span 
class="pcrr7tn-">-C</span>&#x201D; to override the patches you have pushed.
     </li>
     <li class="enumerate"><a 
 id="x16-289032x5"></a>Merge all patches using <a 
 id="dx16-289033"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span> <a 
 id="dx16-289034"></a><a 
 id="dx16-289035"></a><span 
class="pcrr7tn-">-m</span> <a 
 id="dx16-289036"></a><a 
 id="dx16-289037"></a><span 
class="pcrr7tn-">-a</span>&#x201D;. The <a 
 id="dx16-289038"></a><a 
 id="dx16-289039"></a><span 
class="pcrr7tn-">-m </span>option to <a 
 id="dx16-289040"></a><a 
 id="dx16-289041"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; tells MQ to perform a three-way
     merge if the patch fails to apply.</li></ol>
<!--l. 708--><p class="indent">   During the <a 
 id="dx16-289042"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span> <a 
 id="dx16-289043"></a><a 
 id="dx16-289044"></a><span 
class="pcrr7tn-">-m</span>&#x201D;, each patch in the <a 
 id="dx16-289045"></a><span 
class="pcrr7tn-">series </span>file is applied normally. If a patch applies with fuzz or rejects, MQ
looks at the queue you <a 
 id="dx16-289046"></a><a 
 id="dx16-289047"></a>&#x201C;<span 
class="pcrr7tn-">hg qsave</span>&#x201D;d, and performs a three-way merge with the corresponding changeset. This
merge uses Mercurial&#x2019;s normal merge machinery, so it may pop up a GUI merge tool to help you to resolve
problems.
</p><!--l. 715--><p class="indent">   When you finish resolving the effects of a patch, MQ refreshes your patch based on the result of the merge.
</p><!--l. 718--><p class="indent">   At the end of this process, your repository will have one extra head from the old patch queue, and a copy
of the old patch queue will be in <a 
 id="dx16-289048"></a><span 
class="pcrr7tn-">.hg/patches.</span><span 
class="pcrro7t-">N</span>. You can remove the extra head using <a 
 id="dx16-289049"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span> <a 
 id="dx16-289050"></a><a 
 id="dx16-289051"></a><span 
class="pcrr7tn-">-a</span> <a 
 id="dx16-289052"></a><a 
 id="dx16-289053"></a><span 
class="pcrr7tn-">-n</span>
<span 
class="pcrr7tn-">patches.</span><span 
class="pcrro7t-">N</span>&#x201D; or <a 
 id="dx16-289054"></a>&#x201C;<span 
class="pcrr7tn-">hg strip</span>&#x201D;. You can delete <a 
 id="dx16-289055"></a><span 
class="pcrr7tn-">.hg/patches.</span><span 
class="pcrro7t-">N </span>once you are sure that you no longer need it as a
backup.
</p><!--l. 725--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.9    </span> <a 
 id="x16-29000012.9"></a>Identifying patches</h3>
<!--l. 727--><p class="noindent">MQ commands that work with patches let you refer to a patch either by using its name or by a number. By name is obvious
enough; pass the name <span 
class="pcrr7tn-">foo.patch </span>to <a 
 id="dx16-290001"></a><a 
 id="dx16-290002"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D;, for example, and it will push patches until <span 
class="pcrr7tn-">foo.patch </span>is
applied.
</p><!--l. 732--><p class="indent">   As a shortcut, you can refer to a patch using both a name and a numeric offset; <span 
class="pcrr7tn-">foo.patch-2 </span>means &#x201C;two patches before
<span 
class="pcrr7tn-">foo.patch</span>&#x201D;, while <span 
class="pcrr7tn-">bar.patch+4 </span>means &#x201C;four patches after <span 
class="pcrr7tn-">bar.patch</span>&#x201D;.
</p><!--l. 737--><p class="indent">   Referring to a patch by index isn&#x2019;t much different. The first patch printed in the output of <a 
 id="dx16-290003"></a><a 
 id="dx16-290004"></a>&#x201C;<span 
class="pcrr7tn-">hg qseries</span>&#x201D; is patch zero (yes,
it&#x2019;s one of those start-at-zero counting systems); the second is patch one; and so on
</p><!--l. 742--><p class="indent">   MQ also makes it easy to work with patches when you are using normal Mercurial commands. Every command that accepts
a changeset ID will also accept the name of an applied patch. MQ augments the tags normally in the repository with an
eponymous one for each applied patch. In addition, the special tags <a 
 id="dx16-290005"></a><span 
class="pcrr7tn-">qbase </span>and <a 
 id="dx16-290006"></a><span 
class="pcrr7tn-">qtip </span>identify the &#x201C;bottom-most&#x201D; and topmost
applied patches, respectively.
</p><!--l. 751--><p class="indent">   These additions to Mercurial&#x2019;s normal tagging capabilities make dealing with patches even more of a breeze.
</p>
     <ul><li><span class="dt">
     </span><span class="dd">Want to patchbomb a mailing list with your latest series of changes?
     <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-290008r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;email</span><span 
class="pcrr7tn-">&#x00A0;qbase:qtip</span>
</div>
     <!--l. 759--><p class="noindent">(Don&#x2019;t know what &#x201C;patchbombing&#x201D; is? See section&#x00A0;<a 
href="hobbit-sysadmin-guidech14.html#x18-32100014.4">14.4<!--tex4ht:ref: sec:hgext:patchbomb --></a>.)
     </p></span><li><span class="dt">
     </span><span class="dd">Need to see all of the patches since <span 
class="pcrr7tn-">foo.patch </span>that have touched files in a subdirectory of your tree?
     <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-290010r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;log</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;foo.patch:qtip</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrro7t-">subdir</span>
</div>
                                                                                         
                                                                                         
     </li></ul>
<!--l. 768--><p class="indent">   Because MQ makes the names of patches available to the rest of Mercurial through its normal internal tag machinery, you
don&#x2019;t need to type in the entire name of a patch when you want to identify it by name.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-29007514"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-290012r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qapplied</span>
<br class="fancyvrb" /><a 
 id="x16-290014r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290016r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290018r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;log</span><span 
class="pcrb7t-">&#x00A0;-r</span><span 
class="pcrb7t-">&#x00A0;qbase:qtip</span>
<br class="fancyvrb" /><a 
 id="x16-290020r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:fe9dd6094b8c</span>
<br class="fancyvrb" /><a 
 id="x16-290022r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290024r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;qbase</span>
<br class="fancyvrb" /><a 
 id="x16-290026r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x16-290028r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:20</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-290030r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;first.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290032r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-290034r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2:8433cfd09e0c</span>
<br class="fancyvrb" /><a 
 id="x16-290036r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290038r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;qtip</span>
<br class="fancyvrb" /><a 
 id="x16-290040r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x16-290042r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x16-290044r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:21</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-290046r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290048r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-290050r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;export</span><span 
class="pcrb7t-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290052r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;HG</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;patch</span>
<br class="fancyvrb" /><a 
 id="x16-290054r22"></a><span 
class="ptmr7t-x-x-50">22</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;User</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x16-290056r23"></a><span 
class="ptmr7t-x-x-50">23</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;Date</span><span 
class="pcrr7tn-">&#x00A0;1209254661</span><span 
class="pcrr7tn-">&#x00A0;0</span>
<br class="fancyvrb" /><a 
 id="x16-290058r24"></a><span 
class="ptmr7t-x-x-50">24</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;Node</span><span 
class="pcrr7tn-">&#x00A0;ID</span><span 
class="pcrr7tn-">&#x00A0;8433cfd09e0cbe32d67661b543050e82daa16fe3</span>
<br class="fancyvrb" /><a 
 id="x16-290060r25"></a><span 
class="ptmr7t-x-x-50">25</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;#</span><span 
class="pcrr7tn-">&#x00A0;Parent</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;fe9dd6094b8c8e71d77008942deb2fc2302f5960</span>
<br class="fancyvrb" /><a 
 id="x16-290062r26"></a><span 
class="ptmr7t-x-x-50">26</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;patch</span><span 
class="pcrr7tn-">&#x00A0;queue:</span><span 
class="pcrr7tn-">&#x00A0;second.patch</span>
<br class="fancyvrb" /><a 
 id="x16-290064r27"></a><span 
class="ptmr7t-x-x-50">27</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-290066r28"></a><span 
class="ptmr7t-x-x-50">28</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;fe9dd6094b8c</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;8433cfd09e0c</span><span 
class="pcrr7tn-">&#x00A0;other.c</span>
<br class="fancyvrb" /><a 
 id="x16-290068r29"></a><span 
class="ptmr7t-x-x-50">29</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;/dev/null        Thu</span><span 
class="pcrr7tn-">&#x00A0;Jan</span><span 
class="pcrr7tn-">&#x00A0;01</span><span 
class="pcrr7tn-">&#x00A0;00:00:00</span><span 
class="pcrr7tn-">&#x00A0;1970</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-290070r30"></a><span 
class="ptmr7t-x-x-50">30</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/other.c        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:21</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-290072r31"></a><span 
class="ptmr7t-x-x-50">31</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-0,0</span><span 
class="pcrr7tn-">&#x00A0;+1,1</span><span 
class="pcrr7tn-">&#x00A0;@@</span>
<br class="fancyvrb" /><a 
 id="x16-290074r32"></a><span 
class="ptmr7t-x-x-50">32</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+double</span><span 
class="pcrr7tn-">&#x00A0;u;</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.14: </td><td  
class="content">Using MQ&#x2019;s tag features to work with patches</td></tr></table><!--tex4ht:label?: x16-29007514 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 779--><p class="indent">   Another nice consequence of representing patch names as tags is that when you run the <a 
 id="dx16-290076"></a>&#x201C;<span 
class="pcrr7tn-">hg log</span>&#x201D; command, it will display
a patch&#x2019;s name as a tag, simply as part of its normal output. This makes it easy to visually distinguish applied patches from
underlying &#x201C;normal&#x201D; revisions. Figure&#x00A0;<a 
href="#x16-29007514">12.14<!--tex4ht:ref: ex:mq:id --></a> shows a few normal Mercurial commands in use with applied
patches.
</p>
   <h3 class="sectionHead"><span class="titlemark">12.10    </span> <a 
 id="x16-29100012.10"></a>Useful things to know about</h3>
<!--l. 788--><p class="noindent">There are a number of aspects of MQ usage that don&#x2019;t fit tidily into sections of their own, but that are good to know. Here they
are, in one place.
</p>
     <ul><li><span class="dt">
     </span><span class="dd">Normally,  when  you  <a 
 id="dx16-291001"></a><a 
 id="dx16-291002"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span>&#x201D;  a  patch  and  <a 
 id="dx16-291003"></a><a 
 id="dx16-291004"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D;  it  again,  the  changeset  that  represents  the  patch
     after the pop/push will have a <span 
class="ptmri7t-">different identity </span>than the changeset that represented the hash beforehand. See
     section&#x00A0;<a 
href="hobbit-sysadmin-guideap2.html#x20-358000B.1.13">B.1.13<!--tex4ht:ref: sec:mqref:cmd:qpush --></a> for information as to why this is.
     </span><li><span class="dt">
     </span><span class="dd">It&#x2019;s not a good idea to <a 
 id="dx16-291005"></a>&#x201C;<span 
class="pcrr7tn-">hg merge</span>&#x201D; changes from another branch with a patch changeset, at least if you want to
     maintain the &#x201C;patchiness&#x201D; of that changeset and changesets below it on the patch stack. If you try to do this, it
     will appear to succeed, but MQ will become confused.</li></ul>
<!--l. 805--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.11    </span> <a 
 id="x16-29200012.11"></a>Managing patches in a repository</h3>
<!--l. 808--><p class="noindent">Because MQ&#x2019;s <a 
 id="dx16-292001"></a><span 
class="pcrr7tn-">.hg/patches </span>directory resides outside a Mercurial repository&#x2019;s working directory, the &#x201C;underlying&#x201D; Mercurial
repository knows nothing about the management or presence of patches.
</p><!--l. 812--><p class="indent">   This presents the interesting possibility of managing the contents of the patch directory as a Mercurial repository in its own
right. This can be a useful way to work. For example, you can work on a patch for a while, <a 
 id="dx16-292002"></a><a 
 id="dx16-292003"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D;
it, then <a 
 id="dx16-292004"></a>&#x201C;<span 
class="pcrr7tn-">hg commit</span>&#x201D; the current state of the patch. This lets you &#x201C;roll back&#x201D; to that version of the patch later
on.
</p><!--l. 819--><p class="indent">   You can then share different versions of the same patch stack among multiple underlying repositories. I use this when I am
developing a Linux kernel feature. I have a pristine copy of my kernel sources for each of several CPU architectures, and a
cloned repository under each that contains the patches I am working on. When I want to test a change on a different
architecture, I push my current patches to the patch repository associated with that kernel tree, pop and push all of my patches,
and build and test that kernel.
</p><!--l. 828--><p class="indent">   Managing patches in a repository makes it possible for multiple developers to work on the same patch series without
colliding with each other, all on top of an underlying source base that they may or may not control.
</p><!--l. 833--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.11.1    </span> <a 
 id="x16-29300012.11.1"></a>MQ support for patch repositories</h4>
<!--l. 835--><p class="noindent">MQ helps you to work with the <a 
 id="dx16-293001"></a><span 
class="pcrr7tn-">.hg/patches </span>directory as a repository; when you prepare a repository for working with
patches using <a 
 id="dx16-293002"></a><a 
 id="dx16-293003"></a>&#x201C;<span 
class="pcrr7tn-">hg qinit</span>&#x201D;, you can pass the <a 
 id="dx16-293004"></a><a 
 id="dx16-293005"></a><span 
class="pcrr7tn-">-c </span>option to create the <a 
 id="dx16-293006"></a><span 
class="pcrr7tn-">.hg/patches </span>directory as a Mercurial
repository.
</p>
                                                                                         
                                                                                         
   <div class="fbox"><span 
class="ptmb7t-">Note:  </span>If you forget to use the <span 
class="pcrr7tn-">-c </span>option, you can simply go into the <span 
class="pcrr7tn-">.hg/patches</span>
directory  at  any  time  and  run  &#x201C;<span 
class="pcrr7tn-">hg init</span>&#x201D;.  Don&#x2019;t  forget  to  add  an  entry  for  the
<span 
class="pcrr7tn-">status </span>file to the <span 
class="pcrr7tn-">.hgignore </span>file, though
(&#x201C;<span 
class="pcrr7tn-">hg qinit -c</span>&#x201D; does this for you automatically); you <span 
class="ptmri7t-">really </span>don&#x2019;t want to manage
the <span 
class="pcrr7tn-">status </span>file.                                                                                                          </div>
<!--l. 851--><p class="indent">   As a convenience, if MQ notices that the <span 
class="pcrr7tn-">.hg/patches </span>directory is a repository, it will automatically <a 
 id="dx16-293017"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; every patch
that you create and import.
</p><!--l. 855--><p class="indent">   MQ provides a shortcut command, <a 
 id="dx16-293018"></a><a 
 id="dx16-293019"></a>&#x201C;<span 
class="pcrr7tn-">hg qcommit</span>&#x201D;, that runs <a 
 id="dx16-293020"></a>&#x201C;<span 
class="pcrr7tn-">hg commit</span>&#x201D; in the <a 
 id="dx16-293021"></a><span 
class="pcrr7tn-">.hg/patches </span>directory. This saves some
bothersome typing.
</p><!--l. 859--><p class="indent">   Finally, as a convenience to manage the patch directory, you can define the alias <a 
 id="dx16-293022"></a><span 
class="pcrr7tn-">mq </span>on Unix systems. For example, on
Linux systems using the <a 
 id="dx16-293023"></a><span 
class="pcrr7tn-">bash </span>shell, you can include the following snippet in your <span 
class="pcrr7tn-">~/.bashrc</span>.
</p><!--l. 864--><p class="indent">
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-293025r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;alias</span><span 
class="pcrr7tn-">&#x00A0;mq=&#x2018;hg</span><span 
class="pcrr7tn-">&#x00A0;-R</span><span 
class="pcrr7tn-">&#x00A0;$(hg</span><span 
class="pcrr7tn-">&#x00A0;root)/.hg/patches'</span>
   </div>
<!--l. 868--><p class="indent">   You can then issue commands of the form <a 
 id="dx16-293026"></a>&#x201C;<span 
class="pcrr7tn-">mq pull</span>&#x201D; from the main repository.
</p><!--l. 871--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.11.2    </span> <a 
 id="x16-29400012.11.2"></a>A few things to watch out for</h4>
<!--l. 873--><p class="noindent">MQ&#x2019;s support for working with a repository full of patches is limited in a few small respects.
</p><!--l. 876--><p class="indent">   MQ cannot automatically detect changes that you make to the patch directory. If you <a 
 id="dx16-294001"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D;, manually edit, or <a 
 id="dx16-294002"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">update</span>&#x201D; changes to patches or the <a 
 id="dx16-294003"></a><span 
class="pcrr7tn-">series </span>file, you will have to <a 
 id="dx16-294004"></a>&#x201C;<span 
class="pcrr7tn-">hg qpop</span> <a 
 id="dx16-294005"></a><a 
 id="dx16-294006"></a><span 
class="pcrr7tn-">-a</span>&#x201D; and then <a 
 id="dx16-294007"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span> <a 
 id="dx16-294008"></a><a 
 id="dx16-294009"></a><span 
class="pcrr7tn-">-a</span>&#x201D; in the underlying
repository to see those changes show up there. If you forget to do this, you can confuse MQ&#x2019;s idea of which patches are
applied.
</p><!--l. 884--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.12    </span> <a 
 id="x16-29500012.12"></a>Third party tools for working with patches</h3>
<!--l. 887--><p class="noindent">Once you&#x2019;ve been working with patches for a while, you&#x2019;ll find yourself hungry for tools that will help you to understand and
manipulate the patches you&#x2019;re dealing with.
</p><!--l. 891--><p class="indent">   The <a 
 id="dx16-295001"></a><span 
class="pcrr7tn-">diffstat </span>command&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span> generates a histogram of the modifications made to each file in a patch. It provides a good
way to &#x201C;get a sense of&#x201D; a patch&#x2014;which files it affects, and how much change it introduces to each file and as a whole. (I find
that it&#x2019;s a good idea to use <a 
 id="dx16-295002"></a><span 
class="pcrr7tn-">diffstat</span>&#x2019;s <a 
 id="dx16-295003"></a><span 
class="pcrr7tn-">-p </span>option as a matter of course, as otherwise it will try to do clever things with prefixes
of file names that inevitably confuse at least me.)
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x16-29505015"></a>
                                                                                         
                                                                                         
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-295005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">diffstat</span><span 
class="pcrb7t-">&#x00A0;-p1</span><span 
class="pcrb7t-">&#x00A0;remove-redundant-null-checks.patch</span>
<br class="fancyvrb" /><a 
 id="x16-295007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/char/agp/sgi-agp.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;5</span><span 
class="pcrr7tn-">&#x00A0;++---</span>
<br class="fancyvrb" /><a 
 id="x16-295009r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/char/hvcs.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;11</span><span 
class="pcrr7tn-">&#x00A0;+++++------</span>
<br class="fancyvrb" /><a 
 id="x16-295011r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/message/fusion/mptfc.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;6</span><span 
class="pcrr7tn-">&#x00A0;++----</span>
<br class="fancyvrb" /><a 
 id="x16-295013r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/message/fusion/mptsas.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3</span><span 
class="pcrr7tn-">&#x00A0;+--</span>
<br class="fancyvrb" /><a 
 id="x16-295015r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/net/fs_enet/fs_enet-mii.c</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3</span><span 
class="pcrr7tn-">&#x00A0;+--</span>
<br class="fancyvrb" /><a 
 id="x16-295017r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/net/wireless/ipw2200.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;22</span><span 
class="pcrr7tn-">&#x00A0;++++++----------------</span>
<br class="fancyvrb" /><a 
 id="x16-295019r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/scsi/libata-scsi.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;4</span><span 
class="pcrr7tn-">&#x00A0;+---</span>
<br class="fancyvrb" /><a 
 id="x16-295021r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;drivers/video/au1100fb.c</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;|</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3</span><span 
class="pcrr7tn-">&#x00A0;+--</span>
<br class="fancyvrb" /><a 
 id="x16-295023r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;8</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;changed,</span><span 
class="pcrr7tn-">&#x00A0;19</span><span 
class="pcrr7tn-">&#x00A0;insertions(+),</span><span 
class="pcrr7tn-">&#x00A0;38</span><span 
class="pcrr7tn-">&#x00A0;deletions(-)</span>
<br class="fancyvrb" /><a 
 id="x16-295025r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">filterdiff</span><span 
class="pcrb7t-">&#x00A0;-i</span><span 
class="pcrb7t-">&#x00A0;'&#x22C6;/video/&#x22C6;'</span><span 
class="pcrb7t-">&#x00A0;remove-redundant-null-checks.patch</span>
<br class="fancyvrb" /><a 
 id="x16-295027r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/drivers/video/au1100fb.c~remove-redundant-null-checks-before-free-in-drivers</span>
<br class="fancyvrb" /><a 
 id="x16-295029r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;a/drivers/video/au1100fb.c</span>
<br class="fancyvrb" /><a 
 id="x16-295031r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-743,8</span><span 
class="pcrr7tn-">&#x00A0;+743,7</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;void</span><span 
class="pcrr7tn-">&#x00A0;__exit</span><span 
class="pcrr7tn-">&#x00A0;au1100fb_cleanup(void)</span>
<br class="fancyvrb" /><a 
 id="x16-295033r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span>
<br class="fancyvrb" /><a 
 id="x16-295035r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        driver_unregister(&au1100fb_driver);</span>
<br class="fancyvrb" /><a 
 id="x16-295037r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-295039r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;-        if</span><span 
class="pcrr7tn-">&#x00A0;(drv_info.opt_mode)</span>
<br class="fancyvrb" /><a 
 id="x16-295041r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;-                kfree(drv_info.opt_mode);</span>
<br class="fancyvrb" /><a 
 id="x16-295043r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+        kfree(drv_info.opt_mode);</span>
<br class="fancyvrb" /><a 
 id="x16-295045r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x16-295047r22"></a><span 
class="ptmr7t-x-x-50">22</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-295049r23"></a><span 
class="ptmr7t-x-x-50">23</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;module_init(au1100fb_init);</span>
   </div>
<br /><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;12.15: </td><td  
class="content">The <a 
 id="dx16-295051"></a><span 
class="pcrr7tn-">diffstat</span>, <a 
 id="dx16-295052"></a><span 
class="pcrr7tn-">filterdiff</span>, and <a 
 id="dx16-295053"></a><span 
class="pcrr7tn-">lsdiff </span>commands</td></tr></table><!--tex4ht:label?: x16-29505015 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 906--><p class="indent">   The <a 
 id="dx16-295054"></a><span 
class="pcrr7tn-">patchutils </span>package&#x00A0;<span class="cite">[<span 
class="ptmb7t-">?</span>]</span> is invaluable. It provides a set of small utilities that follow the &#x201C;Unix philosophy;&#x201D; each does
one useful thing with a patch. The <a 
 id="dx16-295055"></a><span 
class="pcrr7tn-">patchutils </span>command I use most is <a 
 id="dx16-295056"></a><span 
class="pcrr7tn-">filterdiff</span>, which extracts subsets from a patch file.
For example, given a patch that modifies hundreds of files across dozens of directories, a single invocation of <a 
 id="dx16-295057"></a><span 
class="pcrr7tn-">filterdiff </span>can
generate a smaller patch that only touches files whose names match a particular glob pattern. See section&#x00A0;<a 
href="hobbit-sysadmin-guidech13.html#x17-31500013.9.2">13.9.2<!--tex4ht:ref: mq-collab:tips:interdiff --></a> for another
example.
</p>
   <h3 class="sectionHead"><span class="titlemark">12.13    </span> <a 
 id="x16-29600012.13"></a>Good ways to work with patches</h3>
<!--l. 918--><p class="noindent">Whether you are working on a patch series to submit to a free software or open source project, or a series that you intend to
treat as a sequence of regular changesets when you&#x2019;re done, you can use some simple techniques to keep your work well
organised.
</p><!--l. 923--><p class="indent">   Give your patches descriptive names. A good name for a patch might be <span 
class="pcrr7tn-">rework-device-alloc.patch</span>, because it will
immediately give you a hint what the purpose of the patch is. Long names shouldn&#x2019;t be a problem; you won&#x2019;t be typing the
names often, but you <span 
class="ptmri7t-">will </span>be running commands like <a 
 id="dx16-296001"></a><a 
 id="dx16-296002"></a>&#x201C;<span 
class="pcrr7tn-">hg qapplied</span>&#x201D; and <a 
 id="dx16-296003"></a><a 
 id="dx16-296004"></a>&#x201C;<span 
class="pcrr7tn-">hg qtop</span>&#x201D; over and over. Good naming becomes
especially important when you have a number of patches to work with, or if you are juggling a number of different tasks and
your patches only get a fraction of your attention.
</p><!--l. 932--><p class="indent">   Be aware of what patch you&#x2019;re working on. Use the <a 
 id="dx16-296005"></a><a 
 id="dx16-296006"></a>&#x201C;<span 
class="pcrr7tn-">hg qtop</span>&#x201D; command and skim over the text of your patches
frequently&#x2014;for example, using <a 
 id="dx16-296007"></a>&#x201C;<span 
class="pcrr7tn-">hg tip</span> <a 
 id="dx16-296008"></a><span 
class="pcrr7tn-">-p</span>&#x201D;)&#x2014;to be sure of where you stand. I have several times worked on and <a 
 id="dx16-296009"></a><a 
 id="dx16-296010"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">qrefresh</span>&#x201D;ed a patch other than the one I intended, and it&#x2019;s often tricky to migrate changes into the right patch after making
them in the wrong one.
</p><!--l. 939--><p class="indent">   For this reason, it is very much worth investing a little time to learn how to use some of the third-party tools I
described in section&#x00A0;<a 
href="#x16-29500012.12">12.12<!--tex4ht:ref: sec:mq:tools --></a>, particularly <a 
 id="dx16-296011"></a><span 
class="pcrr7tn-">diffstat </span>and <a 
 id="dx16-296012"></a><span 
class="pcrr7tn-">filterdiff</span>. The former will give you a quick idea of what
changes your patch is making, while the latter makes it easy to splice hunks selectively out of one patch and into
another.
</p><!--l. 946--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.14    </span> <a 
 id="x16-29700012.14"></a>MQ cookbook</h3>
<!--l. 948--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.14.1    </span> <a 
 id="x16-29800012.14.1"></a>Manage &#x201C;trivial&#x201D; patches</h4>
<!--l. 950--><p class="noindent">Because the overhead of dropping files into a new Mercurial repository is so low, it makes a lot of sense to manage patches this
way even if you simply want to make a few changes to a source tarball that you downloaded.
</p><!--l. 955--><p class="indent">   Begin by downloading and unpacking the source tarball, and turning it into a Mercurial repository.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-298002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">download</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.5.tar.bz2</span>
<br class="fancyvrb" /><a 
 id="x16-298004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">tar</span><span 
class="pcrb7t-">&#x00A0;jxf</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.5.tar.bz2</span>
<br class="fancyvrb" /><a 
 id="x16-298006r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.5</span>
<br class="fancyvrb" /><a 
 id="x16-298008r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;init</span>
<br class="fancyvrb" /><a 
 id="x16-298010r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-q</span><span 
class="pcrb7t-">&#x00A0;--addremove</span><span 
class="pcrb7t-">&#x00A0;--message</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.5</span>
<br class="fancyvrb" /><a 
 id="x16-298012r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;..</span>
<br class="fancyvrb" /><a 
 id="x16-298014r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;clone</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.5</span><span 
class="pcrb7t-">&#x00A0;netplug</span>
<br class="fancyvrb" /><a 
 id="x16-298016r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;18</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
   </div>
                                                                                         
                                                                                         
<!--l. 959--><p class="indent">   Continue by creating a patch stack and making your changes.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-298018r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;netplug</span>
<br class="fancyvrb" /><a 
 id="x16-298020r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qinit</span>
<br class="fancyvrb" /><a 
 id="x16-298022r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qnew</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'fix</span><span 
class="pcrb7t-">&#x00A0;build</span><span 
class="pcrb7t-">&#x00A0;problem</span><span 
class="pcrb7t-">&#x00A0;with</span><span 
class="pcrb7t-">&#x00A0;gcc</span><span 
class="pcrb7t-">&#x00A0;4'</span><span 
class="pcrb7t-">&#x00A0;build-fix.patch</span>
<br class="fancyvrb" /><a 
 id="x16-298024r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">perl</span><span 
class="pcrb7t-">&#x00A0;-pi</span><span 
class="pcrb7t-">&#x00A0;-e</span><span 
class="pcrb7t-">&#x00A0;'s/int</span><span 
class="pcrb7t-">&#x00A0;addr_len/socklen_t</span><span 
class="pcrb7t-">&#x00A0;addr_len/'</span><span 
class="pcrb7t-">&#x00A0;netlink.c</span>
<br class="fancyvrb" /><a 
 id="x16-298026r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qrefresh</span>
<br class="fancyvrb" /><a 
 id="x16-298028r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span><span 
class="pcrb7t-">&#x00A0;-p</span>
<br class="fancyvrb" /><a 
 id="x16-298030r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:4f5053e25c5a</span>
<br class="fancyvrb" /><a 
 id="x16-298032r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;qtip</span>
<br class="fancyvrb" /><a 
 id="x16-298034r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;build-fix.patch</span>
<br class="fancyvrb" /><a 
 id="x16-298036r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x16-298038r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;qbase</span>
<br class="fancyvrb" /><a 
 id="x16-298040r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x16-298042r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:21</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-298044r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;fix</span><span 
class="pcrr7tn-">&#x00A0;build</span><span 
class="pcrr7tn-">&#x00A0;problem</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;gcc</span><span 
class="pcrr7tn-">&#x00A0;4</span>
<br class="fancyvrb" /><a 
 id="x16-298046r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-298048r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;af6a01b86aa5</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;4f5053e25c5a</span><span 
class="pcrr7tn-">&#x00A0;netlink.c</span>
<br class="fancyvrb" /><a 
 id="x16-298050r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/netlink.c        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:21</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-298052r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/netlink.c        Sun</span><span 
class="pcrr7tn-">&#x00A0;Apr</span><span 
class="pcrr7tn-">&#x00A0;27</span><span 
class="pcrr7tn-">&#x00A0;00:04:21</span><span 
class="pcrr7tn-">&#x00A0;2008</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x16-298054r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-275,7</span><span 
class="pcrr7tn-">&#x00A0;+275,7</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;netlink_open(void)</span>
<br class="fancyvrb" /><a 
 id="x16-298056r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;exit(1);</span>
<br class="fancyvrb" /><a 
 id="x16-298058r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">}</span>
<br class="fancyvrb" /><a 
 id="x16-298060r22"></a><span 
class="ptmr7t-x-x-50">22</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-298062r23"></a><span 
class="ptmr7t-x-x-50">23</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;-</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;int</span><span 
class="pcrr7tn-">&#x00A0;addr_len</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;sizeof(addr);</span>
<br class="fancyvrb" /><a 
 id="x16-298064r24"></a><span 
class="ptmr7t-x-x-50">24</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;socklen_t</span><span 
class="pcrr7tn-">&#x00A0;addr_len</span><span 
class="pcrr7tn-">&#x00A0;=</span><span 
class="pcrr7tn-">&#x00A0;sizeof(addr);</span>
<br class="fancyvrb" /><a 
 id="x16-298066r25"></a><span 
class="ptmr7t-x-x-50">25</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x16-298068r26"></a><span 
class="ptmr7t-x-x-50">26</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;if</span><span 
class="pcrr7tn-">&#x00A0;(getsockname(fd,</span><span 
class="pcrr7tn-">&#x00A0;(struct</span><span 
class="pcrr7tn-">&#x00A0;sockaddr</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;)</span><span 
class="pcrr7tn-">&#x00A0;&addr,</span><span 
class="pcrr7tn-">&#x00A0;&addr_len)</span><span 
class="pcrr7tn-">&#x00A0;==</span><span 
class="pcrr7tn-">&#x00A0;-1)</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">{</span>
<br class="fancyvrb" /><a 
 id="x16-298070r27"></a><span 
class="ptmr7t-x-x-50">27</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;do_log(LOG_ERR,</span><span 
class="pcrr7tn-">&#x00A0;"Could</span><span 
class="pcrr7tn-">&#x00A0;not</span><span 
class="pcrr7tn-">&#x00A0;get</span><span 
class="pcrr7tn-">&#x00A0;socket</span><span 
class="pcrr7tn-">&#x00A0;details:</span><span 
class="pcrr7tn-">&#x00A0;%m");</span>
<br class="fancyvrb" /><a 
 id="x16-298072r28"></a><span 
class="ptmr7t-x-x-50">28</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 962--><p class="indent">   Let&#x2019;s say a few weeks or months pass, and your package author releases a new version. First, bring their changes into the
repository.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-298074r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qpop</span><span 
class="pcrb7t-">&#x00A0;-a</span>
<br class="fancyvrb" /><a 
 id="x16-298076r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Patch</span><span 
class="pcrr7tn-">&#x00A0;queue</span><span 
class="pcrr7tn-">&#x00A0;now</span><span 
class="pcrr7tn-">&#x00A0;empty</span>
<br class="fancyvrb" /><a 
 id="x16-298078r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;..</span>
<br class="fancyvrb" /><a 
 id="x16-298080r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">download</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.8.tar.bz2</span>
<br class="fancyvrb" /><a 
 id="x16-298082r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;clone</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.5</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.8</span>
<br class="fancyvrb" /><a 
 id="x16-298084r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;18</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x16-298086r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.8</span>
<br class="fancyvrb" /><a 
 id="x16-298088r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;locate</span><span 
class="pcrb7t-">&#x00A0;-0</span><span 
class="pcrb7t-">&#x00A0;|</span><span 
class="pcrb7t-">&#x00A0;xargs</span><span 
class="pcrb7t-">&#x00A0;-0</span><span 
class="pcrb7t-">&#x00A0;rm</span>
<br class="fancyvrb" /><a 
 id="x16-298090r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;..</span>
<br class="fancyvrb" /><a 
 id="x16-298092r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">tar</span><span 
class="pcrb7t-">&#x00A0;jxf</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.8.tar.bz2</span>
<br class="fancyvrb" /><a 
 id="x16-298094r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.8</span>
<br class="fancyvrb" /><a 
 id="x16-298096r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;--addremove</span><span 
class="pcrb7t-">&#x00A0;--message</span><span 
class="pcrb7t-">&#x00A0;netplug-1.2.8</span>
   </div>
<!--l. 965--><p class="noindent">The pipeline starting with <a 
 id="dx16-298097"></a>&#x201C;<span 
class="pcrr7tn-">hg locate</span>&#x201D; above deletes all files in the working directory, so that <a 
 id="dx16-298098"></a>&#x201C;<span 
class="pcrr7tn-">hg commit</span>&#x201D;&#x2019;s <a 
 id="dx16-298099"></a><span 
class="pcrr7tn-">--addremove</span>
                                                                                         
                                                                                         
option can actually tell which files have really been removed in the newer version of the source.
</p><!--l. 970--><p class="indent">   Finally, you can apply your patches on top of the new tree.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-298101r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;../netplug</span>
<br class="fancyvrb" /><a 
 id="x16-298103r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;pull</span><span 
class="pcrb7t-">&#x00A0;../netplug-1.2.8</span>
<br class="fancyvrb" /><a 
 id="x16-298105r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;pulling</span><span 
class="pcrr7tn-">&#x00A0;from</span><span 
class="pcrr7tn-">&#x00A0;../netplug-1.2.8</span>
<br class="fancyvrb" /><a 
 id="x16-298107r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;searching</span><span 
class="pcrr7tn-">&#x00A0;for</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x16-298109r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;changesets</span>
<br class="fancyvrb" /><a 
 id="x16-298111r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;manifests</span>
<br class="fancyvrb" /><a 
 id="x16-298113r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;file</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x16-298115r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;added</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;12</span><span 
class="pcrr7tn-">&#x00A0;changes</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;12</span><span 
class="pcrr7tn-">&#x00A0;files</span>
<br class="fancyvrb" /><a 
 id="x16-298117r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;(run</span><span 
class="pcrr7tn-">&#x00A0;'hg</span><span 
class="pcrr7tn-">&#x00A0;update'</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;get</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;working</span><span 
class="pcrr7tn-">&#x00A0;copy)</span>
<br class="fancyvrb" /><a 
 id="x16-298119r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;qpush</span><span 
class="pcrb7t-">&#x00A0;-a</span>
<br class="fancyvrb" /><a 
 id="x16-298121r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;applying</span><span 
class="pcrr7tn-">&#x00A0;build-fix.patch</span>
<br class="fancyvrb" /><a 
 id="x16-298123r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Now</span><span 
class="pcrr7tn-">&#x00A0;at:</span><span 
class="pcrr7tn-">&#x00A0;build-fix.patch</span>
   </div>
<!--l. 973--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.14.2    </span> <a 
 id="x16-29900012.14.2"></a>Combining entire patches</h4>
<!--l. 976--><p class="noindent">MQ provides a command, <a 
 id="dx16-299001"></a><a 
 id="dx16-299002"></a>&#x201C;<span 
class="pcrr7tn-">hg qfold</span>&#x201D; that lets you combine entire patches. This &#x201C;folds&#x201D; the patches you name, in the order
you name them, into the topmost applied patch, and concatenates their descriptions onto the end of its description. The patches
that you fold must be unapplied before you fold them.
</p><!--l. 982--><p class="indent">   The order in which you fold patches matters. If your topmost applied patch is <span 
class="pcrr7tn-">foo</span>, and you <a 
 id="dx16-299003"></a><a 
 id="dx16-299004"></a>&#x201C;<span 
class="pcrr7tn-">hg qfold</span>&#x201D; <span 
class="pcrr7tn-">bar </span>and <span 
class="pcrr7tn-">quux</span>
into it, you will end up with a patch that has the same effect as if you applied first <span 
class="pcrr7tn-">foo</span>, then <span 
class="pcrr7tn-">bar</span>, followed by
<span 
class="pcrr7tn-">quux</span>.
</p><!--l. 988--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">12.14.3    </span> <a 
 id="x16-30000012.14.3"></a>Merging part of one patch into another</h4>
<!--l. 990--><p class="noindent">Merging <span 
class="ptmri7t-">part </span>of one patch into another is more difficult than combining entire patches.
</p><!--l. 993--><p class="indent">   If you want to move changes to entire files, you can use <a 
 id="dx16-300001"></a><span 
class="pcrr7tn-">filterdiff</span>&#x2019;s <a 
 id="dx16-300002"></a><span 
class="pcrr7tn-">-i </span>and <a 
 id="dx16-300003"></a><span 
class="pcrr7tn-">-x </span>options to choose the modifications to
snip out of one patch, concatenating its output onto the end of the patch you want to merge into. You usually won&#x2019;t need to
modify the patch you&#x2019;ve merged the changes from. Instead, MQ will report some rejected hunks when you <a 
 id="dx16-300004"></a><a 
 id="dx16-300005"></a>&#x201C;<span 
class="pcrr7tn-">hg qpush</span>&#x201D; it (from
the hunks you moved into the other patch), and you can simply <a 
 id="dx16-300006"></a><a 
 id="dx16-300007"></a>&#x201C;<span 
class="pcrr7tn-">hg qrefresh</span>&#x201D; the patch to drop the duplicate
hunks.
</p><!--l. 1003--><p class="indent">   If you have a patch that has multiple hunks modifying a file, and you only want to move a few of those hunks, the job
becomes more messy, but you can still partly automate it. Use <a 
 id="dx16-300008"></a>&#x201C;<span 
class="pcrr7tn-">lsdiff -nvv</span>&#x201D; to print some metadata about the
patch.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x16-300010r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">lsdiff</span><span 
class="pcrb7t-">&#x00A0;-nvv</span><span 
class="pcrb7t-">&#x00A0;remove-redundant-null-checks.patch</span>
<br class="fancyvrb" /><a 
 id="x16-300012r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;22        File</span><span 
class="pcrr7tn-">&#x00A0;#1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/char/agp/sgi-agp.c</span>
<br class="fancyvrb" /><a 
 id="x16-300014r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        24        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        static</span><span 
class="pcrr7tn-">&#x00A0;int</span><span 
class="pcrr7tn-">&#x00A0;__devinit</span><span 
class="pcrr7tn-">&#x00A0;agp_sgi_init(void)</span>
<br class="fancyvrb" /><a 
 id="x16-300016r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;37        File</span><span 
class="pcrr7tn-">&#x00A0;#2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/char/hvcs.c</span>
<br class="fancyvrb" /><a 
 id="x16-300018r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        39        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        static</span><span 
class="pcrr7tn-">&#x00A0;struct</span><span 
class="pcrr7tn-">&#x00A0;tty_operations</span><span 
class="pcrr7tn-">&#x00A0;hvcs_ops</span><span 
class="pcrr7tn-">&#x00A0;=</span>
                                                                                         
                                                                                         
<br class="fancyvrb" /><a 
 id="x16-300020r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        53        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#2        static</span><span 
class="pcrr7tn-">&#x00A0;int</span><span 
class="pcrr7tn-">&#x00A0;hvcs_alloc_index_list(int</span><span 
class="pcrr7tn-">&#x00A0;n)</span>
<br class="fancyvrb" /><a 
 id="x16-300022r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;69        File</span><span 
class="pcrr7tn-">&#x00A0;#3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/message/fusion/mptfc.c</span>
<br class="fancyvrb" /><a 
 id="x16-300024r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        71        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        mptfc_GetFcDevPage0(MPT_ADAPTER</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;ioc,</span><span 
class="pcrr7tn-">&#x00A0;in</span>
<br class="fancyvrb" /><a 
 id="x16-300026r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;85        File</span><span 
class="pcrr7tn-">&#x00A0;#4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/message/fusion/mptsas.c</span>
<br class="fancyvrb" /><a 
 id="x16-300028r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        87        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        mptsas_probe_hba_phys(MPT_ADAPTER</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;ioc)</span>
<br class="fancyvrb" /><a 
 id="x16-300030r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;98        File</span><span 
class="pcrr7tn-">&#x00A0;#5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/net/fs_enet/fs_enet-mii.c</span>
<br class="fancyvrb" /><a 
 id="x16-300032r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        100        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        static</span><span 
class="pcrr7tn-">&#x00A0;struct</span><span 
class="pcrr7tn-">&#x00A0;fs_enet_mii_bus</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;create_bu</span>
<br class="fancyvrb" /><a 
 id="x16-300034r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;111        File</span><span 
class="pcrr7tn-">&#x00A0;#6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/net/wireless/ipw2200.c</span>
<br class="fancyvrb" /><a 
 id="x16-300036r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        113        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        static</span><span 
class="pcrr7tn-">&#x00A0;struct</span><span 
class="pcrr7tn-">&#x00A0;ipw_fw_error</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;ipw_alloc_er</span>
<br class="fancyvrb" /><a 
 id="x16-300038r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        126        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#2        static</span><span 
class="pcrr7tn-">&#x00A0;ssize_t</span><span 
class="pcrr7tn-">&#x00A0;clear_error(struct</span><span 
class="pcrr7tn-">&#x00A0;device</span>
<br class="fancyvrb" /><a 
 id="x16-300040r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        140        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#3        static</span><span 
class="pcrr7tn-">&#x00A0;void</span><span 
class="pcrr7tn-">&#x00A0;ipw_irq_tasklet(struct</span><span 
class="pcrr7tn-">&#x00A0;ipw_p</span>
<br class="fancyvrb" /><a 
 id="x16-300042r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        150        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#4        static</span><span 
class="pcrr7tn-">&#x00A0;void</span><span 
class="pcrr7tn-">&#x00A0;ipw_pci_remove(struct</span><span 
class="pcrr7tn-">&#x00A0;pci_de</span>
<br class="fancyvrb" /><a 
 id="x16-300044r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;164        File</span><span 
class="pcrr7tn-">&#x00A0;#7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/scsi/libata-scsi.c</span>
<br class="fancyvrb" /><a 
 id="x16-300046r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        166        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        int</span><span 
class="pcrr7tn-">&#x00A0;ata_cmd_ioctl(struct</span><span 
class="pcrr7tn-">&#x00A0;scsi_device</span><span 
class="pcrr7tn-">&#x00A0;&#x22C6;sc</span>
<br class="fancyvrb" /><a 
 id="x16-300048r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;178        File</span><span 
class="pcrr7tn-">&#x00A0;#8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        a/drivers/video/au1100fb.c</span>
<br class="fancyvrb" /><a 
 id="x16-300050r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;        180        Hunk</span><span 
class="pcrr7tn-">&#x00A0;#1        void</span><span 
class="pcrr7tn-">&#x00A0;__exit</span><span 
class="pcrr7tn-">&#x00A0;au1100fb_cleanup(void)</span>
   </div>
<!--l. 1009--><p class="indent">   This command prints three different kinds of number: </p>
     <ul><li><span class="dt">
     </span><span class="dd">(in the first column) a <span 
class="ptmri7t-">file number </span>to identify each file modified in the patch;
     </span><li><span class="dt">
     </span><span class="dd">(on the next line, indented) the line number within a modified file where a hunk starts; and
     </span><li><span class="dt">
     </span><span class="dd">(on the same line) a <span 
class="ptmri7t-">hunk number </span>to identify that hunk.</li></ul>
<!--l. 1018--><p class="indent">   You&#x2019;ll have to use some visual inspection, and reading of the patch, to identify the file and hunk numbers you&#x2019;ll want, but
you can then pass them to to <a 
 id="dx16-300051"></a><span 
class="pcrr7tn-">filterdiff</span>&#x2019;s <a 
 id="dx16-300052"></a><span 
class="pcrr7tn-">--files </span>and <a 
 id="dx16-300053"></a><span 
class="pcrr7tn-">--hunks </span>options, to select exactly the file and hunk you want to
extract.
</p><!--l. 1024--><p class="indent">   Once you have this hunk, you can concatenate it onto the end of your destination patch and continue with the remainder of
section&#x00A0;<a 
href="#x16-29900012.14.2">12.14.2<!--tex4ht:ref: sec:mq:combine --></a>.
</p><!--l. 1028--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">12.15    </span> <a 
 id="x16-30100012.15"></a>Differences between quilt and MQ</h3>
<!--l. 1030--><p class="noindent">If you are already familiar with quilt, MQ provides a similar command set. There are a few differences in the way that it
works.
</p><!--l. 1033--><p class="indent">   You will already have noticed that most quilt commands have MQ counterparts that simply begin with a &#x201C;<span 
class="pcrr7tn-">q</span>&#x201D;. The
exceptions are quilt&#x2019;s <span 
class="pcrr7tn-">add </span>and <span 
class="pcrr7tn-">remove </span>commands, the counterparts for which are the normal Mercurial <a 
 id="dx16-301001"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; and <a 
 id="dx16-301002"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">remove</span>&#x201D; commands. There is no MQ equivalent of the quilt <span 
class="pcrr7tn-">edit </span>command.
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
</p>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="hobbit-sysadmin-guidech13.html" >next</a>] [<a 
href="hobbit-sysadmin-guidech11.html" >prev</a>] [<a 
href="hobbit-sysadmin-guidech11.html#tailhobbit-sysadmin-guidech11.html" >prev-tail</a>] [<a 
href="hobbit-sysadmin-guidech12.html" >front</a>] [<a 
href="hobbit-sysadmin-guide.html#hobbit-sysadmin-guidech12.html" >up</a>] </p></div>
<!--l. 1--><p class="indent">   <a 
 id="tailhobbit-sysadmin-guidech12.html"></a>  </p> 
</body></html> 
