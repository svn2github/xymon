
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of HOBBITD_RRD</TITLE>
</HEAD><BODY>
<H1>HOBBITD_RRD</H1>
Section: Maintenance Commands (8)<BR>Updated: Version Exp: 11 Jan 2008<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

hobbitd_rrd - hobbitd worker module for updating Hobbit RRD files
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>hobbitd_channel --channel=status hobbitd_rrd [options]</B>

<BR>

<B>hobbitd_channel --channel=data hobbitd_rrd [options]</B>

<P>
<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

hobbitd_rrd is a worker module for hobbitd, and as such it is normally
run via the
<I><A HREF="../man8/hobbitd_channel.8.html">hobbitd_channel</A>(8)</I>

program. It receives &quot;status&quot; and &quot;data&quot; messages from hobbitd via
stdin, and updates the RRD databases used to generate trend-graphs.
<P>
Clients can send data to Hobbit using both status- and data-
messages. So you will normally run two instances of this module, 
once for the &quot;status&quot; channel and once for the &quot;data&quot; channel.
<P>
hobbitd_rrd understands data sent by the LARRD 0.43c client-side
scripts (the so-called &quot;bottom-feeder&quot; scripts). So you still want
to install the LARRD bottom-feeders on the clients you monitor.
<P>
Note: For certain types of data, the RRD files used by Hobbit are
imcompatible with those generated by the Big Brother LARRD add-on. 
See the COMPATIBILITY section below.
<P>
<P>
<A NAME="lbAE">&nbsp;</A>
<H2>OPTIONS</H2>

<DL COMPACT>
<DT>--debug<DD>
Enable debugging output.
<P>
<DT>--rrddir=DIRECTORY<DD>
Defines the directory where the RRD-files are stored. hobbitd_rrd
will use the location pointed to by the BBRRDS environment if this
option is not present.
<P>
<DT>--extra-script=FILENAME<DD>
Defines the script that is run to get the RRD data for tests that are not
built into hobbitd_rrd. You must also specify which tests are handled
by the external script in the <B>--extra-tests</B> option. This option
can only be given once, so the script must handle all of the external
test-data. See the CUSTOM RRD DATA section below. Note that this is
NOT needed if your custom graphs are generated by the NCV (Name Colon
Value) module described below, it is only required for data where you
have a custom script to parse the status message and extract the data
that is put into the graph.
<P>
<DT>--extra-tests=TEST[,TEST]<DD>
List of testnames that are handled by the external script. See the
CUSTOM RRD DATA section below. Note that NCV graphs should NOT be
listed here, but in the TEST2RRD environment variable - see below.
<P>
<DT>--processor=COMMAND<DD>
Feed the raw RRD data into COMMAND via standard input. COMMAND must be
a simple command with no options; if necessary, COMMAND can be a script
that runs the real command with the necessary options. The data sent to
COMMAND consists of lines of text of the form
<BR>

<BR>&nbsp;&nbsp;&nbsp;dsname1[:dsname2]&nbsp;time:value1[:value2]&nbsp;rrdtype&nbsp;[key1]&nbsp;[key2]
<BR>

First the dataset names, corresponding to the DS definitions in the RRD files.
Next the timestamp of the update, followed by the values in the same order
as the dsname-list. Third item is the hostname, fourth is the type of RRD file. 
After that there may be between 0-2 additional keys: For &quot;disk&quot; this is the 
filesystem mountpoint, for &quot;tcp&quot; tests it is the service name, for &quot;tcp&quot; &quot;http&quot; 
tests there is also the URL checked. Note that filesystem names and URLs have 
forward slash substituted by comma. See the hobbitd/rrd/*.c sourcecode for details, 
look for the &quot;setupfn&quot; function calls. An example:
<BR>

<P>
<PRE>
la 1196115478:7 myhost la
la 1196115478:169 myhost procs
la 1196115478:1 myhost users
la 1196115478:244 myhost clock
pct:used 1196115478:63:62338144 myhost disk ,root
realmempct 1196115478:76 myhost memory real
realmempct 1196115478:0 myhost memory swap
realmempct 1196115478:20 myhost memory actual
sec 1196115478:0.03 tcp myhost conn
sec 1196115478:1.38 myhost tcp http <A HREF="http://www.hobbitmon.com">www.hobbitmon.com</A>,
</PRE>

<P>
<P>
<P>
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>ENVIRONMENT</H2>

<DL COMPACT>
<DT>TEST2RRD<DD>
Defines the mapping between a status-log columnname and the corresponding
RRD database format. This is normally defined in the 
<I><A HREF="../man5/hobbitserver.cfg.5.html">hobbitserver.cfg</A>(5)</I>

file.
<P>
<DT>BBRRDS<DD>
Default directory where RRD files are stored.
<P>
<DT>NCV_testname<DD>
Defines the types of data collected by the &quot;ncv&quot; module in hobbitd_rrd.
See below for more information.
<P>
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>COLLECTED DATA</H2>

The following RRD-file datasets are generated by hobbitd_rrd:
<P>
<DL COMPACT>
<DT>la<DD>
Records the CPU load average. Data is collected from the &quot;cpu&quot;
status report. Requires that a Hobbit client is running
on the monitored server.
<P>
<DT>disk<DD>
Records the disk utilization. Data is collected from the &quot;disk&quot;
status report. Requires that a Hobbit-compatible client is running
on the monitored server.
<P>
<DT>memory<DD>
Records memory- and swap-utilization. Data is collected from the
&quot;memory&quot; status report. If no &quot;memory&quot; status is reported, it will
use the data from the Win32 client &quot;cpu&quot; status report to generate
this dataset. Requires that a Hobbit-compatible client is running
on the monitored server.
<P>
<DT>netstat<DD>
Records TCP and UDP statistics. Data is collected from the &quot;netstat&quot;
status report; however, this data is often sent via the Hobbit
&quot;data&quot; protocol, so there need not be a &quot;netstat&quot; column visible
on the Hobbit display. To get these data, the LARRD netstat bottom-feeder
script must be running on the monitored server.
<P>
<DT>vmstat<DD>
Records system performance metrics from the &quot;vmstat&quot; command.
Data is collected from the &quot;vmstat&quot; status report; however, this 
data is often sent via the Hobbit &quot;data&quot; protocol, so there need 
not be a &quot;vmstat&quot; column visible on the Hobbit display. To get 
these data, the LARRD vmstat bottom-feeder script must be running on
the monitored server.
<P>
<DT>tcp<DD>
Response-time metrics from all of the Hobbit network tests are
recorded in the &quot;tcp&quot; RRD.
<P>
<DT>apache<DD>
Apache server performance metrics, taken from the &quot;apache&quot; data
report. See the description of the <B>apache</B> keyword in 
<I><A HREF="../man5/bb-hosts.5.html">bb-hosts</A>(5)</I>

for details.
<P>
<DT>sendmail<DD>
Sendmail server performance metrics, taken from the &quot;mailstats&quot;
output. To get these data, the LARRD sendmail bottom-feeder script must
be running on the monitored server.
<P>
<DT>mailq<DD>
Mail queue size. To get these data, the LARRD nmailq bottom-feeder script
must be running on the monitored server.
<P>
<DT>bea<DD>
BEA Weblogic performance data. This is an experimental set of data
collected from BEA Weblogic servers via SNMP, by the &quot;beastats&quot; tool 
included with Hobbit.
<P>
<DT>iishealth<DD>
IIS webserver performance data, collected by the &quot;iishealth&quot; script.
This script is a client-side add-on available from the <A HREF="http://www.deadcat.net">www.deadcat.net</A> 
archive.
<P>
<DT>temperature<DD>
Temperature data, collected with the temperature script from
<A HREF="http://www.deadcat.net">www.deadcat.net</A>. To get these data, the temperature script must
be running on the monitored server.
<P>
<DT>ntpstat<DD>
Tracks the deviation between the local system time and an NTP
server, using the output from the &quot;ntpq -c rv&quot; command.
A simple script to collect these data is included in the
Hobbit contrib/ directory.
<P>
<DT>citrix<DD>
Tracks the number of active sessions on a Citrix server using
the &quot;query session&quot; command. An extension for the BBNT client
that generates data for this graph is in the Hobbit contrib/ 
directory.
<P>
<P>
</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>CUSTOM RRD DATA IN NAME-COLON-VALUE (NCV) FORMAT</H2>

Many data-collection scripts report data in the form &quot;NAME : value&quot;
or &quot;NAME = value&quot;. So a generic module in hobbitd_rrd allows for
easy tracking of this type of data.
<P>
The &quot;ncv&quot; module will automatically detect all occurrences of
a &quot;NAME : value&quot; or &quot;NAME = value&quot; string in a status message, and
generate an RRD file holding all of the name/value data found in
the message. The colon- or equal-sign must be present - if there is
only whitespace, this module will fail.
<P>
Only the valid letters (A-Z, a-z) and digits (0-9) are used in the 
dataset names; whitespace and other characters are stripped off 
automatically. Only the first 19 characters of a dataset name are
used (this is an RRD limitation). Underscore '_' is not allowed,
even though RRDtool permits this, and will be stripped from the
name.
<P>
Note that each &quot;NAME : value&quot; must be on a line by itself. If you have
a custom script generating the status- or data-message that is fed
into the NCV handler, make sure it inserts a newline before each
of the data-items you want to track.
<P>
To enable the ncv module for a status, add a &quot;COLUMNNAME=ncv&quot; to the 
TEST2RRD setting and the COLUMNNAME to the GRAPHS setting in
<I><A HREF="../man5/hobbitserver.cfg.5.html">hobbitserver.cfg</A>(5)</I>

, then restart Hobbit. Hobbit will now send
all status-messages for the column COLUMNNAME through the hobbitd_rrd
ncv-handler.
<P>
The name of the RRD file will be COLUMNNAME.rrd.
<P>
By default, all of the datasets are generated as the RRD type &quot;DERIVE&quot;
which works for all types of monotonically increasing counters. If you 
have data that are of the type GAUGE, you can override the default via
an environment variable NCV_COLUMNNAME. 
<P>
E.g. if you are using the bb-mysqlstatus script from <A HREF="http://www.deadcat.net">www.deadcat.net</A> to 
collect data about your MySQL server, it generates a report in the column 
called &quot;mysql&quot;. One data item is the average number of queries/second,
which must be logged in the RRD file as type &quot;GAUGE&quot;. To do that, add
the following to hobbitserver.cfg:
<BR>

<BR>&nbsp;&nbsp;&nbsp;&nbsp;NCV_mysql=&quot;Queriespersecondavg:GAUGE&quot;&nbsp;
<BR>

If you have multiple datasets that you myst define, add them to the 
environment variable separated by commas, e.g.
<BR>

<BR>&nbsp;&nbsp;&nbsp;&nbsp;NCV_mysql=&quot;Uptime:NONE,Queriespersecondavg:GAUGE&quot;&nbsp;
<BR>

<P>
The dataset type &quot;NONE&quot; used above causes hobbitd_rrd to ignore this
data, it is not included in the RRD file.
<P>
You can use &quot;*&quot; as the dataset name to match all datasets not listed.
E.g.
<BR>

<BR>&nbsp;&nbsp;&nbsp;&nbsp;NCV_weather=&quot;Rain:DERIVE,*:GAUGE&quot;
<BR>

will cause the &quot;Rainfall&quot; dataset to be of type DERIVE, and all others
of type GAUGE. If you want to track only a few of the variables in
your data, you can use &quot;*:NONE&quot; to drop any dataset not explicitly
listed.
<P>
For a more detailed &quot;how to&quot; description, see the on-line HTML
documentation of &quot;How to create graph custom data&quot; available in
the Help menu section on your Hobbit server.
<P>
<P>
<A NAME="lbAI">&nbsp;</A>
<H2>CUSTOM RRD DATA VIA SCRIPTS</H2>

hobbitd_rrd provides a simple mechanism for adding custom graphs
to the set of data collected on your Hobbit server. By adding the
&quot;--extra-script&quot; and &quot;--extra-tests&quot; options, data reported to Hobbit
from selected tests are passed to an external script, which can 
define the RRD data-sets to store in an RRD file.
<P>
<B>NOTE:</B> For performance reasons, you should not use this mechanism
for large amounts of data. The overhead involved in storing the received
message to disk and launching the script is significantly larger than
the normal hobbitd_rrd overhead. So if you have a large number of
reports for a given test, you should consider implementing it in C
and including it in the hobbitd_rrd tool.
<P>
Apart from writing the script, You must also add a section to
<I><A HREF="../man5/hobbitgraph.cfg.5.html">hobbitgraph.cfg</A>(5)</I>

so that
<I><A HREF="../man1/hobbitgraph.cgi.1.html">hobbitgraph.cgi</A>(1)</I>

knows how to generate the graph from the data stored in the RRD file. 
To make the graphs actually show up on the status-page and/or the
&quot;trends&quot; page, add the name of the new graph to the TEST2RRD and/or 
GRAPHS setting in
<I><A HREF="../man5/hobbitserver.cfg.5.html">hobbitserver.cfg</A>(5).</I>

<P>
The script is invoked for each message that arrives, where the test-name
matches one of the testnames given in the &quot;--extra-tests&quot; option. The
script receives three commandline parameters:
<P>
<DL COMPACT>
<DT><B>Hostname</B>

<DD>
The name of the host reporting the data.
<DT><B>Testname</B>

<DD>
The name of the test being reported.
<DT><B>Filename</B>

<DD>
File containing the data that was reported. This file is generated for
you by hobbitd_rrd, and is also deleted automatically after your script
is finished with it.
<P>
</DL>
<P>

The script must process the data that is reported, and generate the following
output:
<P>
<DL COMPACT>
<DT><B>RRD data-set definitions</B>

<DD>
For each dataset that the RRD file holds, a line beginning with &quot;DS:&quot; must be
output.  If multiple data-sets are used, print one line for each dataset.
<BR>

Data-set definitions are described in the
<I><A HREF="../man1/rrdcreate.1.html">rrdcreate</A>(1)</I>

documentation, but a common definition for e.g. tracking the number of users 
logged on would be &quot;DS:users:GAUGE:600:0:U&quot;. &quot;users&quot; is the name of the dataset,
&quot;GAUGE&quot; is the datatype, &quot;600&quot; is the longest time allowed between updates for
the data to be valid, &quot;0&quot; is the minimum value, and &quot;U&quot; is the maximum value
(a &quot;U&quot; means &quot;unknown&quot;). 
<DT><B>RRD filename</B>

<DD>
The name of the RRD file where the data is stored. Note that Hobbit stores all
RRD files in host-specific directories, so unlike LARRD you should not include
the hostname in the name of the RRD file.
<DT><B>RRD values</B>

<DD>
One line, with all of the data values collected by the script. Data-items are
colon-delimited and must appear in the same sequence as your data-set definitions, 
e.g. if your RRD has two datasets with the values &quot;5&quot; and &quot;0.4&quot; respectively, 
then the script must output &quot;5:0.4&quot; as the RRD values.
<BR>

In some cases it may be useful to define a dataset even though you will not
always have data for it. In that case, use &quot;U&quot; (unknown) for the value.
<P>
If you want to store the data in multiple RRD files, the script can just print out
more sequences of data-set definitions, RRD filenames and RRD values. If the
data-set definitions are identical to the previous definition, you need not
print the data-set definitions again - just print a new RRD filename and value.
<P>
</DL>
<P>

The following sample script for tracking weather data shows how to use this 
mechanism. It assumes the status message include lines like these:
<DL COMPACT>
<DT><DD>
<PRE>
green Weather in Copenhagen is FAIR

Temperature: 21 degrees Celsius
Wind: 4 m/s
Humidity: 72 %
Rainfall: 5 mm since 6:00 AM
</PRE>

</DL>
<P>

A shell-script to track all of these variables could be written like this:
<DL COMPACT>
<DT><DD>
<PRE>
#!/bin/sh

# Input parameters: Hostname, testname (column), and messagefile
HOSTNAME=&quot;$1&quot;
TESTNAME=&quot;$2&quot;
FNAME=&quot;$3&quot;

if [ &quot;$TESTNAME&quot; = &quot;weather&quot; ]
then
        # Analyze the message we got
        TEMP=`grep &quot;^Temperature:&quot; $FNAME | awk '{print $2}'`
        WIND=`grep &quot;^Wind:&quot; $FNAME | awk '{print $2}'`
        HMTY=`grep &quot;^Humidity:&quot; $FNAME | awk '{print $2}'`
        RAIN=`grep &quot;^Rainfall:&quot; $FNAME | awk '{print $2}'`

        # The RRD dataset definitions
        echo &quot;DS:temperature:GAUGE:600:-30:50&quot;
        echo &quot;DS:wind:GAUGE:600:0:U&quot;
        echo &quot;DS:humidity:GAUGE:600:0:100&quot;
        echo &quot;DS:rainfall:DERIVE:600:0:100&quot;

        # The filename
        echo &quot;weather.rrd&quot;

        # The data
        echo &quot;$TEMP:$WIND:$HMTY:$RAIN&quot;
fi

exit 0
</PRE>

<P>
<P>
</DL>
<A NAME="lbAJ">&nbsp;</A>
<H2>COMPATIBILITY</H2>

<P>
Some of the RRD files generated by hobbitd_rrd are incompatible with
the files generated by the Big Brother LARRD add-on:
<P>
<DL COMPACT>
<DT>vmstat<DD>
The vmstat files with data from Linux based systems are incompatible
due to the addition of a number of new data-items that LARRD 0.43
do not collect, but hobbitd_rrd does. This is due to changes in the
output from the Linux vmstat command, and changes in the way e.g. 
system load metrics are reported.
<P>
<DT>netstat<DD>
All netstat files from LARRD 0.43 are incompatible with hobbitd_rrd.
The netstat data collected by LARRD is quite confusing: For some types
of systems LARRD collects packet-counts, for others it collects byte-
counts. hobbitd_rrd uses a different RRD file-format with separate
counters for packets and bytes and tracks whatever data the system is
reporting.
<P>
<P>
</DL>
<A NAME="lbAK">&nbsp;</A>
<H2>SEE ALSO</H2>

<A HREF="../man8/hobbitd_channel.8.html">hobbitd_channel</A>(8), <A HREF="../man8/hobbitd.8.html">hobbitd</A>(8), <A HREF="../man5/hobbitserver.cfg.5.html">hobbitserver.cfg</A>(5), <A HREF="../man7/hobbit.7.html">hobbit</A>(7)
<P>
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">OPTIONS</A><DD>
<DT><A HREF="#lbAF">ENVIRONMENT</A><DD>
<DT><A HREF="#lbAG">COLLECTED DATA</A><DD>
<DT><A HREF="#lbAH">CUSTOM RRD DATA IN NAME-COLON-VALUE (NCV) FORMAT</A><DD>
<DT><A HREF="#lbAI">CUSTOM RRD DATA VIA SCRIPTS</A><DD>
<DT><A HREF="#lbAJ">COMPATIBILITY</A><DD>
<DT><A HREF="#lbAK">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 16:21:47 GMT, January 11, 2008
</BODY>
</HTML>
